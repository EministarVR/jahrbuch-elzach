<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/admin/ReportsList.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/admin/ReportsList.tsx" />
              <option name="originalContent" value="'use client';&#10;&#10;import { useTransition } from 'react';&#10;import { useRouter } from 'next/navigation';&#10;import GlowButton from '@/components/ui/GlowButton';&#10;import { CheckCircle2, XCircle } from 'lucide-react';&#10;&#10;interface Report {&#10;  id: number;&#10;  submission_id: number;&#10;  reporter: string;&#10;  reason: string;&#10;  created_at: string;&#10;  submission_text: string;&#10;  submission_author: string;&#10;}&#10;&#10;export default function ReportsList({ reports }: { reports: Report[] }) {&#10;  const router = useRouter();&#10;  const [isPending, startTransition] = useTransition();&#10;&#10;  const handleReview = async (reportId: number, action: 'reviewed' | 'dismissed') =&gt; {&#10;    try {&#10;      const response = await fetch('/api/admin/reports', {&#10;        method: 'POST',&#10;        headers: { 'Content-Type': 'application/json' },&#10;        body: JSON.stringify({ reportId, action }),&#10;      });&#10;&#10;      if (response.ok) {&#10;        startTransition(() =&gt; {&#10;          router.refresh();&#10;        });&#10;      }&#10;    } catch (error) {&#10;      console.error('Review error:', error);&#10;      alert('Fehler beim Bearbeiten der Meldung.');&#10;    }&#10;  };&#10;&#10;  if (reports.length === 0) {&#10;    return (&#10;      &lt;div className=&quot;text-center py-12&quot;&gt;&#10;        &lt;div className=&quot;inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-[#7a9b88]/10 dark:bg-[#8faf9d]/10 text-[#7a9b88] dark:text-[#8faf9d] mb-4&quot;&gt;&#10;          &lt;CheckCircle2 className=&quot;h-8 w-8&quot; /&gt;&#10;        &lt;/div&gt;&#10;        &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Keine offenen Meldungen. Alles sauber! ✨&lt;/p&gt;&#10;      &lt;/div&gt;&#10;    );&#10;  }&#10;&#10;  return (&#10;    &lt;&gt;&#10;      &lt;div className=&quot;space-y-4&quot;&gt;&#10;        {reports.map((report) =&gt; (&#10;          &lt;div key={report.id} className=&quot;rounded-2xl border border-red-500/20 dark:border-red-400/20 bg-red-50/50 dark:bg-red-900/10 p-5 hover:border-red-500/30 dark:hover:border-red-400/30 transition-all&quot;&gt;&#10;            &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;              &lt;div className=&quot;flex-1&quot;&gt;&#10;                &lt;div className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5] mb-3&quot;&gt;&#10;                  Gemeldet von &lt;strong className=&quot;text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{report.reporter}&lt;/strong&gt; am {new Date(report.created_at).toLocaleString('de-DE')}&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;mb-4&quot;&gt;&#10;                  &lt;div className=&quot;text-xs font-semibold text-[#2a2520] dark:text-[#f5f1ed] mb-1&quot;&gt;Grund:&lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-red-700 dark:text-red-300 bg-white/50 dark:bg-[#2a2520]/50 rounded-lg p-3 border border-red-200 dark:border-red-800&quot;&gt;&#10;                    {report.reason}&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-xs font-semibold text-[#2a2520] dark:text-[#f5f1ed] mb-1&quot;&gt;&#10;                    Beitrag von &lt;strong&gt;{report.submission_author}&lt;/strong&gt;:&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#2a2520] dark:text-[#f5f1ed] bg-white/50 dark:bg-[#2a2520]/50 rounded-lg p-3 border border-[#d97757]/20 dark:border-[#e89a7a]/20&quot;&gt;&#10;                    {report.submission_text}&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;shrink-0 flex flex-col gap-2&quot;&gt;&#10;                &lt;GlowButton&#10;                  onClick={() =&gt; handleReview(report.id, 'reviewed')}&#10;                  variant=&quot;primary&quot;&#10;                  className=&quot;px-4 py-2 text-sm whitespace-nowrap&quot;&#10;                  iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                  disabled={isPending}&#10;                &gt;&#10;                  Geprüft&#10;                &lt;/GlowButton&gt;&#10;                &lt;GlowButton&#10;                  onClick={() =&gt; handleReview(report.id, 'dismissed')}&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;px-4 py-2 text-sm whitespace-nowrap&quot;&#10;                  iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                  disabled={isPending}&#10;                &gt;&#10;                  Abweisen&#10;                &lt;/GlowButton&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        ))}&#10;      &lt;/div&gt;&#10;&#10;      {isPending &amp;&amp; (&#10;        &lt;div className=&quot;fixed inset-0 bg-black/20 flex items-center justify-center z-50&quot;&gt;&#10;          &lt;div className=&quot;bg-white dark:bg-[#2a2520] rounded-2xl p-6 shadow-xl&quot;&gt;&#10;            &lt;div className=&quot;animate-spin rounded-full h-8 w-8 border-b-2 border-[#d97757] dark:border-[#e89a7a]&quot;&gt;&lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      )}&#10;    &lt;/&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="'use client';&#10;&#10;import { useTransition } from 'react';&#10;import { useRouter } from 'next/navigation';&#10;import GlowButton from '@/components/ui/GlowButton';&#10;import { CheckCircle2, XCircle } from 'lucide-react';&#10;&#10;interface Report {&#10;  id: number;&#10;  submission_id: number;&#10;  reporter: string;&#10;  reason: string;&#10;  created_at: string;&#10;  submission_text: string;&#10;  submission_author: string;&#10;}&#10;&#10;export default function ReportsList({ reports }: { reports: Report[] }) {&#10;  const router = useRouter();&#10;  const [isPending, startTransition] = useTransition();&#10;&#10;  const handleReview = async (reportId: number, action: 'reviewed' | 'dismissed') =&gt; {&#10;    try {&#10;      const response = await fetch('/api/admin/reports', {&#10;        method: 'POST',&#10;        headers: { 'Content-Type': 'application/json' },&#10;        body: JSON.stringify({ reportId, action }),&#10;      });&#10;&#10;      if (response.ok) {&#10;        startTransition(() =&gt; {&#10;          router.refresh();&#10;        });&#10;      }&#10;    } catch (error) {&#10;      console.error('Review error:', error);&#10;      alert('Fehler beim Bearbeiten der Meldung.');&#10;    }&#10;  };&#10;&#10;  if (reports.length === 0) {&#10;    return (&#10;      &lt;div className=&quot;text-center py-12&quot;&gt;&#10;        &lt;div className=&quot;inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-[#8faf9d]/10 text-[#8faf9d] mb-4&quot;&gt;&#10;          &lt;CheckCircle2 className=&quot;h-8 w-8&quot; /&gt;&#10;        &lt;/div&gt;&#10;        &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Keine offenen Meldungen. Alles sauber! ✨&lt;/p&gt;&#10;      &lt;/div&gt;&#10;    );&#10;  }&#10;&#10;  return (&#10;    &lt;&gt;&#10;      &lt;div className=&quot;space-y-4&quot;&gt;&#10;        {reports.map((report) =&gt; (&#10;          &lt;div key={report.id} className=&quot;rounded-2xl border border-red-400/20 bg-red-900/10 p-5 hover:border-red-400/30 transition-all&quot;&gt;&#10;            &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;              &lt;div className=&quot;flex-1&quot;&gt;&#10;                &lt;div className=&quot;text-xs text-[#b8aea5] mb-3&quot;&gt;&#10;                  Gemeldet von &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt;{report.reporter}&lt;/strong&gt; am {new Date(report.created_at).toLocaleString('de-DE')}&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;mb-4&quot;&gt;&#10;                  &lt;div className=&quot;text-xs font-semibold text-[#f5f1ed] mb-1&quot;&gt;Grund:&lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-red-300 bg-[#2a2520]/50 rounded-lg p-3 border border-red-800&quot;&gt;&#10;                    {report.reason}&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-xs font-semibold text-[#f5f1ed] mb-1&quot;&gt;&#10;                    Beitrag von &lt;strong&gt;{report.submission_author}&lt;/strong&gt;:&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#f5f1ed] bg-[#2a2520]/50 rounded-lg p-3 border border-[#e89a7a]/20&quot;&gt;&#10;                    {report.submission_text}&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;shrink-0 flex flex-col gap-2&quot;&gt;&#10;                &lt;GlowButton&#10;                  onClick={() =&gt; handleReview(report.id, 'reviewed')}&#10;                  variant=&quot;primary&quot;&#10;                  className=&quot;px-4 py-2 text-sm whitespace-nowrap&quot;&#10;                  iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                  disabled={isPending}&#10;                &gt;&#10;                  Geprüft&#10;                &lt;/GlowButton&gt;&#10;                &lt;GlowButton&#10;                  onClick={() =&gt; handleReview(report.id, 'dismissed')}&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;px-4 py-2 text-sm whitespace-nowrap&quot;&#10;                  iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                  disabled={isPending}&#10;                &gt;&#10;                  Abweisen&#10;                &lt;/GlowButton&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        ))}&#10;      &lt;/div&gt;&#10;&#10;      {isPending &amp;&amp; (&#10;        &lt;div className=&quot;fixed inset-0 bg-black/20 flex items-center justify-center z-50&quot;&gt;&#10;          &lt;div className=&quot;bg-[#2a2520] rounded-2xl p-6 shadow-xl&quot;&gt;&#10;            &lt;div className=&quot;animate-spin rounded-full h-8 w-8 border-b-2 border-[#e89a7a]&quot;&gt;&lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      )}&#10;    &lt;/&gt;&#10;  );&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/admin/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/admin/page.tsx" />
              <option name="originalContent" value="import { redirect } from &quot;next/navigation&quot;;&#10;import { getSession } from &quot;@/lib/session&quot;;&#10;import { query } from &quot;@/lib/db&quot;;&#10;import { ensureModerationSchema, ensurePhaseSettings } from &quot;@/lib/migrations&quot;;&#10;import { getPhaseSettings } from &quot;@/lib/phases&quot;;&#10;import GlassCard from &quot;@/components/ui/GlassCard&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import {&#10;  approveSubmissionAction,&#10;  deleteSubmissionAction,&#10;  restoreSubmissionAction,&#10;  approveManySubmissionsAction,&#10;  deleteManySubmissionsAction,&#10;  togglePhaseAction,&#10;} from &quot;./actions&quot;;&#10;import ReportsList from &quot;./ReportsList&quot;;&#10;import {&#10;  CheckCircle2,&#10;  XCircle,&#10;  RotateCcw,&#10;  User2,&#10;  FileText,&#10;  Users,&#10;  Trash2,&#10;  Clock,&#10;  Shield,&#10;  Activity,&#10;  Layers,&#10;  ToggleLeft,&#10;  Wrench,&#10;  Flag,&#10;} from &quot;lucide-react&quot;;&#10;&#10;export const dynamic = &quot;force-dynamic&quot;;&#10;&#10;type SubmissionRow = {&#10;  id: number;&#10;  user_id: number;&#10;  text: string;&#10;  category: string;&#10;  name: string | null;&#10;  phone: string | null;&#10;  created_at: string;&#10;  status: &quot;pending&quot; | &quot;approved&quot; | &quot;deleted&quot;;&#10;  approved_by: number | null;&#10;  approved_at: string | null;&#10;  deleted_by: number | null;&#10;  deleted_at: string | null;&#10;  author: string;&#10;  approver: string | null;&#10;  deleter: string | null;&#10;};&#10;&#10;type AuditRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  action: &quot;create&quot; | &quot;approve&quot; | &quot;delete&quot; | &quot;restore&quot;;&#10;  actor_user_id: number;&#10;  created_at: string;&#10;  actor: string;&#10;  preview: string;&#10;};&#10;&#10;type ReportRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  reporter_user_id: number;&#10;  reason: string;&#10;  status: 'pending' | 'reviewed' | 'dismissed';&#10;  created_at: string;&#10;  reporter: string;&#10;  submission_text: string;&#10;  submission_author: string;&#10;};&#10;&#10;export default async function AdminPage({ searchParams }: { searchParams: Promise&lt;{ [_key: string]: string | string[] | undefined }&gt; }) {&#10;  const session = await getSession();&#10;  if (!session) redirect(&quot;/login&quot;);&#10;  if (session.role !== &quot;moderator&quot; &amp;&amp; session.role !== &quot;admin&quot;) redirect(&quot;/zugriff-verweigert&quot;);&#10;  const isAdmin = session.role === &quot;admin&quot;;&#10;&#10;  // Ensure schema is ready (adds status columns + audit table if missing)&#10;  await ensureModerationSchema();&#10;  await ensurePhaseSettings();&#10;&#10;  const [stats] = (await query&lt;&#10;    { pending: number; approved: number; deleted: number; total: number }[]&#10;  &gt;(&#10;    &quot;SELECT SUM(status='pending') AS pending, SUM(status='approved') AS approved, SUM(status='deleted') AS deleted, COUNT(*) AS total FROM submissions&quot;&#10;  )) || [{ pending: 0, approved: 0, deleted: 0, total: 0 }];&#10;&#10;  const sp = await searchParams;&#10;  const q = typeof sp?.q === &quot;string&quot; ? sp.q.trim() : &quot;&quot;;&#10;  const category = typeof sp?.category === &quot;string&quot; ? sp.category.trim() : &quot;&quot;;&#10;  const wherePendingParts: string[] = [&quot;s.status = 'pending'&quot;];&#10;  const pendingParams: string[] = [];&#10;  if (category) { wherePendingParts.push(&quot;s.category = ?&quot;); pendingParams.push(category); }&#10;  if (q) {&#10;    wherePendingParts.push(&quot;(s.text LIKE ? OR au.username LIKE ? OR COALESCE(s.name,'') LIKE ? OR COALESCE(s.phone,'') LIKE ?)&quot;);&#10;    const like = `%${q}%`;&#10;    pendingParams.push(like, like, like, like);&#10;  }&#10;  const pending = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE ${wherePendingParts.join(&quot; AND &quot;)}&#10;     ORDER BY s.created_at DESC`,&#10;    pendingParams&#10;  );&#10;&#10;  const approved = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'approved'&#10;     ORDER BY s.approved_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const deleted = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'deleted'&#10;     ORDER BY s.deleted_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const audit = await query&lt;AuditRow[]&gt;(&#10;    `SELECT a.*, u.username AS actor, LEFT(s.text, 80) AS preview&#10;     FROM submission_audit a&#10;     JOIN users u ON u.id = a.actor_user_id&#10;     JOIN submissions s ON s.id = a.submission_id&#10;     ORDER BY a.created_at DESC&#10;     LIMIT 60`&#10;  );&#10;&#10;  const reports = await query&lt;ReportRow[]&gt;(&#10;    `SELECT r.*, &#10;            u.username AS reporter,&#10;            LEFT(s.text, 100) AS submission_text,&#10;            au.username AS submission_author&#10;     FROM submission_reports r&#10;     JOIN users u ON u.id = r.reporter_user_id&#10;     JOIN submissions s ON s.id = r.submission_id&#10;     JOIN users au ON au.id = s.user_id&#10;     WHERE r.status = 'pending'&#10;     ORDER BY r.created_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const categories = await query&lt;{ category: string }[]&gt;(&#10;    &quot;SELECT DISTINCT category FROM submissions ORDER BY category&quot;&#10;  );&#10;&#10;  const phaseSettings = await getPhaseSettings();&#10;&#10;  return (&#10;    &lt;div className=&quot;relative min-h-dvh overflow-hidden bg-gradient-to-br from-[#faf8f5] via-[#faf4ed] to-[#f5ede3] dark:from-[#1a1714] dark:via-[#221e1a] dark:to-[#1a1714]&quot;&gt;&#10;      {/* Subtile Hintergrundeffekte */}&#10;      &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;        &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#d97757]/8 dark:bg-[#e89a7a]/6 blur-3xl&quot; /&gt;&#10;        &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#7a9b88]/8 dark:bg-[#8faf9d]/6 blur-3xl&quot; /&gt;&#10;      &lt;/div&gt;&#10;&#10;      &lt;div className=&quot;max-w-6xl mx-auto px-4 py-12 space-y-10&quot;&gt;&#10;        &lt;div className=&quot;text-center mb-12&quot;&gt;&#10;          &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#7a9b88]/10 dark:bg-[#8faf9d]/10 border border-[#7a9b88]/20 dark:border-[#8faf9d]/20&quot;&gt;&#10;            &lt;Shield className=&quot;h-4 w-4 text-[#7a9b88] dark:text-[#8faf9d]&quot; /&gt;&#10;            &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#7a9b88] dark:text-[#8faf9d]&quot;&gt;&#10;              Admin-Bereich&#10;            &lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold text-[#2a2520] dark:text-[#f5f1ed] mb-4&quot;&gt;&#10;            Dashboard&#10;          &lt;/h1&gt;&#10;          &lt;p className=&quot;text-lg text-[#6b635a] dark:text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;            Moderiere Einsendungen, verwalte Accounts und behalte den Überblick.&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        {/* Statistiken */}&#10;        &lt;div className=&quot;grid gap-6 md:grid-cols-4&quot;&gt;&#10;          {[&#10;            { label: &quot;Gesamt&quot;, value: stats?.total || 0, icon: &lt;Users className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#d97757] to-[#c96846]&quot; },&#10;            { label: &quot;Ausstehend&quot;, value: stats?.pending || 0, icon: &lt;Clock className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#b8957a] to-[#a88568]&quot; },&#10;            { label: &quot;Genehmigt&quot;, value: stats?.approved || 0, icon: &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#7a9b88] to-[#6a8b78]&quot; },&#10;            { label: &quot;Gelöscht&quot;, value: stats?.deleted || 0, icon: &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#c96846] to-[#b85836]&quot; },&#10;          ].map((s, i) =&gt; (&#10;            &lt;GlassCard key={s.label} delay={i * 0.06}&gt;&#10;              &lt;div className=&quot;flex items-center gap-4&quot;&gt;&#10;                &lt;div className={`h-12 w-12 rounded-2xl bg-gradient-to-br ${s.color} flex items-center justify-center text-white shadow-lg`}&gt;&#10;                  {s.icon}&#10;                &lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;{s.label}&lt;/div&gt;&#10;                  &lt;div className=&quot;text-2xl font-bold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{s.value}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          ))}&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid lg:grid-cols-3 gap-8&quot;&gt;&#10;          {/* Moderationsliste */}&#10;          &lt;div className=&quot;lg:col-span-2 space-y-8&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 dark:bg-[#e89a7a]/10 text-[#d97757] dark:text-[#e89a7a]&quot;&gt;&#10;                    &lt;FileText className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Ausstehende Einsendungen&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Prüfen, genehmigen oder löschen.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {/* Filter */}&#10;              &lt;form method=&quot;GET&quot; className=&quot;mb-6 flex flex-wrap items-center gap-3&quot;&gt;&#10;                &lt;input&#10;                  type=&quot;text&quot;&#10;                  name=&quot;q&quot;&#10;                  defaultValue={q}&#10;                  placeholder=&quot;Suche Text/Autor/Name&quot;&#10;                  className=&quot;input-base flex-1 min-w-[200px]&quot;&#10;                /&gt;&#10;                &lt;select&#10;                  name=&quot;category&quot;&#10;                  defaultValue={category}&#10;                  className=&quot;input-base min-w-[160px]&quot;&#10;                &gt;&#10;                  &lt;option value=&quot;&quot;&gt;Alle Kategorien&lt;/option&gt;&#10;                  {categories.map((c) =&gt; (&#10;                    &lt;option key={c.category} value={c.category}&gt;{c.category}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-5&quot;&gt;Filtern&lt;/GlowButton&gt;&#10;                &lt;a href=&quot;/admin&quot; className=&quot;text-sm text-[#d97757] dark:text-[#e89a7a] hover:underline&quot;&gt;Zurücksetzen&lt;/a&gt;&#10;              &lt;/form&gt;&#10;&#10;              {pending.length === 0 ? (&#10;                &lt;div className=&quot;text-center py-12&quot;&gt;&#10;                  &lt;div className=&quot;inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-[#7a9b88]/10 dark:bg-[#8faf9d]/10 text-[#7a9b88] dark:text-[#8faf9d] mb-4&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-8 w-8&quot; /&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Keine ausstehenden Einsendungen. Alles erledigt! ✨&lt;/p&gt;&#10;                &lt;/div&gt;&#10;              ) : (&#10;                &lt;form&gt;&#10;                  &lt;div className=&quot;mb-4 flex items-center justify-end gap-3&quot;&gt;&#10;                    &lt;GlowButton&#10;                      formAction={approveManySubmissionsAction}&#10;                      variant=&quot;primary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl genehmigen&#10;                    &lt;/GlowButton&gt;&#10;                    &lt;GlowButton&#10;                      formAction={deleteManySubmissionsAction}&#10;                      variant=&quot;secondary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl löschen&#10;                    &lt;/GlowButton&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;space-y-4&quot;&gt;&#10;                    {pending.map((p) =&gt; (&#10;                      &lt;div key={p.id} className=&quot;rounded-2xl border border-[#d97757]/15 dark:border-[#e89a7a]/15 bg-white/80 dark:bg-[#2a2520]/80 p-5 hover:border-[#d97757]/25 dark:hover:border-[#e89a7a]/25 transition-all&quot;&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                          &lt;div className=&quot;flex items-start gap-4 flex-1&quot;&gt;&#10;                            &lt;input&#10;                              type=&quot;checkbox&quot;&#10;                              name=&quot;ids&quot;&#10;                              value={p.id}&#10;                              className=&quot;mt-1.5 h-5 w-5 rounded border-[#d97757]/30 dark:border-[#e89a7a]/30 text-[#d97757] dark:text-[#e89a7a] focus:ring-[#d97757]/50&quot;&#10;                            /&gt;&#10;                            &lt;div className=&quot;flex-1&quot;&gt;&#10;                              &lt;div className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5] flex flex-wrap items-center gap-2 mb-3&quot;&gt;&#10;                                &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&#10;                                  &lt;User2 className=&quot;h-3.5 w-3.5 text-[#7a9b88] dark:text-[#8faf9d]&quot; /&gt;&#10;                                  &lt;strong className=&quot;text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{p.author}&lt;/strong&gt;&#10;                                &lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span&gt;{new Date(p.created_at).toLocaleString(&quot;de-DE&quot;)}&lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#d97757]/10 dark:bg-[#e89a7a]/10 text-[#d97757] dark:text-[#e89a7a] text-xs font-medium border border-[#d97757]/20 dark:border-[#e89a7a]/20&quot;&gt;&#10;                                  {p.category}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                              &lt;div className=&quot;text-sm text-[#2a2520] dark:text-[#f5f1ed] leading-relaxed whitespace-pre-wrap&quot;&gt;&#10;                                {p.text}&#10;                              &lt;/div&gt;&#10;                              {(p.name || p.phone) &amp;&amp; (&#10;                                &lt;div className=&quot;mt-3 pt-3 border-t border-[#d97757]/10 dark:border-[#e89a7a]/10 text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;&#10;                                  {[p.name, p.phone].filter(Boolean).join(&quot; · &quot;)}&#10;                                &lt;/div&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;shrink-0 flex flex-col gap-2&quot;&gt;&#10;                            &lt;form action={approveSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;primary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Genehmigen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                            &lt;form action={deleteSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;secondary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Löschen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    ))}&#10;                  &lt;/div&gt;&#10;                &lt;/form&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#7a9b88]/10 dark:bg-[#8faf9d]/10 text-[#7a9b88] dark:text-[#8faf9d]&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Genehmigt (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {approved.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Noch nichts genehmigt.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {approved.map((a) =&gt; (&#10;                    &lt;div key={a.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#7a9b88]/15 dark:border-[#8faf9d]/15 bg-[#7a9b88]/5 dark:bg-[#8faf9d]/5 p-4 hover:border-[#7a9b88]/25 dark:hover:border-[#8faf9d]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;strong&gt;{a.author}&lt;/strong&gt; • {a.category} • genehmigt von &lt;strong&gt;{a.approver || &quot;—&quot;}&lt;/strong&gt; am {a.approved_at ? new Date(a.approved_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#2a2520] dark:text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap&quot;&gt;{a.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={deleteSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={a.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;secondary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;Trash2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Löschen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#c96846]/10 dark:bg-[#d97757]/10 text-[#c96846] dark:text-[#d97757]&quot;&gt;&#10;                    &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Gelöscht (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {deleted.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Keine gelöschten Beiträge.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {deleted.map((d) =&gt; (&#10;                    &lt;div key={d.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#c96846]/15 dark:border-[#d97757]/15 bg-[#c96846]/5 dark:bg-[#d97757]/5 p-4 hover:border-[#c96846]/25 dark:hover:border-[#d97757]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;strong&gt;{d.author}&lt;/strong&gt; • {d.category} • gelöscht von &lt;strong&gt;{d.deleter || &quot;—&quot;}&lt;/strong&gt; am {d.deleted_at ? new Date(d.deleted_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#2a2520] dark:text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap opacity-75&quot;&gt;{d.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={restoreSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={d.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;primary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;RotateCcw className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Wiederherstellen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-red-500/10 dark:bg-red-400/10 text-red-600 dark:text-red-400&quot;&gt;&#10;                    &lt;Flag className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Gemeldete Beiträge&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;User-Meldungen prüfen und bearbeiten.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;ReportsList reports={reports} /&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;&#10;          {/* Sidebar */}&#10;          &lt;div className=&quot;lg:col-span-1 space-y-6&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#7a9b88]/10 dark:bg-[#8faf9d]/10 text-[#7a9b88] dark:text-[#8faf9d]&quot;&gt;&#10;                    &lt;Shield className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Schnellzugriff&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3&quot;&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Zur Startseite&#10;                &lt;/GlowButton&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/phase-1&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Beitrag einreichen&#10;                &lt;/GlowButton&gt;&#10;                {isAdmin &amp;&amp; (&#10;                  &lt;GlowButton&#10;                    as=&quot;a&quot;&#10;                    href=&quot;/admin/user&quot;&#10;                    variant=&quot;primary&quot;&#10;                    className=&quot;w-full justify-start&quot;&#10;                    iconLeft={&lt;Users className=&quot;h-4 w-4&quot; /&gt;}&#10;                  &gt;&#10;                    Benutzerverwaltung&#10;                  &lt;/GlowButton&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 dark:bg-[#e89a7a]/10 text-[#d97757] dark:text-[#e89a7a]&quot;&gt;&#10;                    &lt;Activity className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Aktivitätsprotokoll&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[500px] overflow-y-auto&quot;&gt;&#10;                {audit.slice(0, 20).map((log) =&gt; (&#10;                  &lt;div key={log.id} className=&quot;text-xs&quot;&gt;&#10;                    &lt;div className=&quot;flex items-center gap-2 text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;&#10;                      &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                        log.action === 'create' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'approve' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'delete' ? 'bg-[#c96846]' :&#10;                        'bg-[#d97757]'&#10;                      }`} /&gt;&#10;                      &lt;strong className=&quot;text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{log.actor}&lt;/strong&gt;&#10;                      &lt;span&gt;•&lt;/span&gt;&#10;                      &lt;span&gt;{log.action === 'create' ? 'erstellt' : log.action === 'approve' ? 'genehmigt' : log.action === 'delete' ? 'gelöscht' : 'wiederhergestellt'}&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;mt-1 text-[#6b635a] dark:text-[#b8aea5] line-clamp-2 pl-4&quot;&gt;&#10;                      {log.preview}...&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;text-[#6b635a] dark:text-[#b8aea7] opacity-60 pl-4 mt-0.5&quot;&gt;&#10;                      {new Date(log.created_at).toLocaleString(&quot;de-DE&quot;)}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            {/* Phase Control Panel (only for admins) */}&#10;            {isAdmin &amp;&amp; (&#10;              &lt;GlassCard&#10;                header={&#10;                  &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                    &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#4caf50]/10 dark:bg-[#66bb6a]/10 text-[#4caf50] dark:text-[#66bb6a]&quot;&gt;&#10;                      &lt;Layers className=&quot;h-5 w-5&quot; /&gt;&#10;                    &lt;/span&gt;&#10;                    &lt;div&gt;&#10;                      &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Phasensteuerung&lt;/h3&gt;&#10;                      &lt;p className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Aktiviere/Deaktiviere Phasen für User&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                }&#10;              &gt;&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {phaseSettings.map((phase) =&gt; {&#10;                    const isDevelopment = phase.status === 'development';&#10;&#10;                    return (&#10;                      &lt;div key={phase.id} className={`rounded-xl border ${&#10;                        phase.enabled &#10;                          ? 'border-[#4caf50]/20 dark:border-[#66bb6a]/20 bg-[#4caf50]/5 dark:bg-[#66bb6a]/5' &#10;                          : isDevelopment&#10;                          ? 'border-[#ff9800]/20 dark:border-[#ffb74d]/20 bg-[#ff9800]/5 dark:bg-[#ffb74d]/5'&#10;                          : 'border-[#6b635a]/20 dark:border-[#b8aea5]/20 bg-[#6b635a]/5 dark:bg-[#b8aea5]/5'&#10;                      } p-4 transition-all`}&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-3 mb-3&quot;&gt;&#10;                          &lt;div className=&quot;flex-1&quot;&gt;&#10;                            &lt;div className=&quot;flex items-center gap-2 mb-1&quot;&gt;&#10;                              &lt;div className=&quot;text-sm font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;&#10;                                {phase.title}&#10;                              &lt;/div&gt;&#10;                              {isDevelopment &amp;&amp; (&#10;                                &lt;span className=&quot;inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[#ff9800]/10 dark:bg-[#ffb74d]/10 text-[#ff9800] dark:text-[#ffb74d] text-xs font-medium border border-[#ff9800]/20 dark:border-[#ffb74d]/20&quot;&gt;&#10;                                  &lt;Wrench className=&quot;h-3 w-3&quot; /&gt;&#10;                                  In Entwicklung&#10;                                &lt;/span&gt;&#10;                              )}&#10;                              {!isDevelopment &amp;&amp; (&#10;                                &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                                  phase.enabled ? 'bg-[#4caf50] animate-pulse' : 'bg-[#f44336]'&#10;                                }`} /&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                            &lt;p className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;&#10;                              {phase.description}&#10;                            &lt;/p&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        {isDevelopment ? (&#10;                          &lt;div className=&quot;rounded-lg bg-[#ff9800]/10 dark:bg-[#ffb74d]/10 border border-[#ff9800]/20 dark:border-[#ffb74d]/20 px-4 py-3 text-center&quot;&gt;&#10;                            &lt;span className=&quot;text-xs font-medium text-[#ff9800] dark:text-[#ffb74d]&quot;&gt;&#10;                              Diese Phase ist noch nicht fertig und kann nicht aktiviert werden&#10;                            &lt;/span&gt;&#10;                          &lt;/div&gt;&#10;                        ) : (&#10;                          &lt;form action={togglePhaseAction}&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;phaseKey&quot; value={phase.phase_key} /&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;enabled&quot; value={phase.enabled ? 'false' : 'true'} /&gt;&#10;                            &lt;GlowButton&#10;                              variant={phase.enabled ? &quot;secondary&quot; : &quot;primary&quot;}&#10;                              className=&quot;w-full text-sm&quot;&#10;                              iconLeft={phase.enabled ? &lt;ToggleLeft className=&quot;h-4 w-4&quot; /&gt; : &lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                            &gt;&#10;                              {phase.enabled ? 'Deaktivieren' : 'Aktivieren'}&#10;                            &lt;/GlowButton&gt;&#10;                          &lt;/form&gt;&#10;                        )}&#10;                      &lt;/div&gt;&#10;                    );&#10;                  })}&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;mt-4 p-3 rounded-xl bg-[#2196f3]/5 dark:bg-[#64b5f6]/5 border border-[#2196f3]/20 dark:border-[#64b5f6]/20&quot;&gt;&#10;                  &lt;div className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;&#10;                    &lt;strong className=&quot;text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt; Info:&lt;/strong&gt; Admins können deaktivierte Phasen trotzdem betreten (Testzwecke).&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/GlassCard&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="import { redirect } from &quot;next/navigation&quot;;&#10;import { getSession } from &quot;@/lib/session&quot;;&#10;import { query } from &quot;@/lib/db&quot;;&#10;import { ensureModerationSchema, ensurePhaseSettings } from &quot;@/lib/migrations&quot;;&#10;import { getPhaseSettings } from &quot;@/lib/phases&quot;;&#10;import GlassCard from &quot;@/components/ui/GlassCard&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import {&#10;  approveSubmissionAction,&#10;  deleteSubmissionAction,&#10;  restoreSubmissionAction,&#10;  approveManySubmissionsAction,&#10;  deleteManySubmissionsAction,&#10;  togglePhaseAction,&#10;} from &quot;./actions&quot;;&#10;import ReportsList from &quot;./ReportsList&quot;;&#10;import {&#10;  CheckCircle2,&#10;  XCircle,&#10;  RotateCcw,&#10;  User2,&#10;  FileText,&#10;  Users,&#10;  Trash2,&#10;  Clock,&#10;  Shield,&#10;  Activity,&#10;  Layers,&#10;  ToggleLeft,&#10;  Wrench,&#10;  Flag,&#10;} from &quot;lucide-react&quot;;&#10;&#10;export const dynamic = &quot;force-dynamic&quot;;&#10;&#10;type SubmissionRow = {&#10;  id: number;&#10;  user_id: number;&#10;  text: string;&#10;  category: string;&#10;  name: string | null;&#10;  phone: string | null;&#10;  created_at: string;&#10;  status: &quot;pending&quot; | &quot;approved&quot; | &quot;deleted&quot;;&#10;  approved_by: number | null;&#10;  approved_at: string | null;&#10;  deleted_by: number | null;&#10;  deleted_at: string | null;&#10;  author: string;&#10;  approver: string | null;&#10;  deleter: string | null;&#10;};&#10;&#10;type AuditRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  action: &quot;create&quot; | &quot;approve&quot; | &quot;delete&quot; | &quot;restore&quot;;&#10;  actor_user_id: number;&#10;  created_at: string;&#10;  actor: string;&#10;  preview: string;&#10;};&#10;&#10;type ReportRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  reporter_user_id: number;&#10;  reason: string;&#10;  status: 'pending' | 'reviewed' | 'dismissed';&#10;  created_at: string;&#10;  reporter: string;&#10;  submission_text: string;&#10;  submission_author: string;&#10;};&#10;&#10;export default async function AdminPage({ searchParams }: { searchParams: Promise&lt;{ [_key: string]: string | string[] | undefined }&gt; }) {&#10;  const session = await getSession();&#10;  if (!session) redirect(&quot;/login&quot;);&#10;  if (session.role !== &quot;moderator&quot; &amp;&amp; session.role !== &quot;admin&quot;) redirect(&quot;/zugriff-verweigert&quot;);&#10;  const isAdmin = session.role === &quot;admin&quot;;&#10;&#10;  // Ensure schema is ready (adds status columns + audit table if missing)&#10;  await ensureModerationSchema();&#10;  await ensurePhaseSettings();&#10;&#10;  const [stats] = (await query&lt;&#10;    { pending: number; approved: number; deleted: number; total: number }[]&#10;  &gt;(&#10;    &quot;SELECT SUM(status='pending') AS pending, SUM(status='approved') AS approved, SUM(status='deleted') AS deleted, COUNT(*) AS total FROM submissions&quot;&#10;  )) || [{ pending: 0, approved: 0, deleted: 0, total: 0 }];&#10;&#10;  const sp = await searchParams;&#10;  const q = typeof sp?.q === &quot;string&quot; ? sp.q.trim() : &quot;&quot;;&#10;  const category = typeof sp?.category === &quot;string&quot; ? sp.category.trim() : &quot;&quot;;&#10;  const wherePendingParts: string[] = [&quot;s.status = 'pending'&quot;];&#10;  const pendingParams: string[] = [];&#10;  if (category) { wherePendingParts.push(&quot;s.category = ?&quot;); pendingParams.push(category); }&#10;  if (q) {&#10;    wherePendingParts.push(&quot;(s.text LIKE ? OR au.username LIKE ? OR COALESCE(s.name,'') LIKE ? OR COALESCE(s.phone,'') LIKE ?)&quot;);&#10;    const like = `%${q}%`;&#10;    pendingParams.push(like, like, like, like);&#10;  }&#10;  const pending = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE ${wherePendingParts.join(&quot; AND &quot;)}&#10;     ORDER BY s.created_at DESC`,&#10;    pendingParams&#10;  );&#10;&#10;  const approved = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'approved'&#10;     ORDER BY s.approved_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const deleted = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'deleted'&#10;     ORDER BY s.deleted_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const audit = await query&lt;AuditRow[]&gt;(&#10;    `SELECT a.*, u.username AS actor, LEFT(s.text, 80) AS preview&#10;     FROM submission_audit a&#10;     JOIN users u ON u.id = a.actor_user_id&#10;     JOIN submissions s ON s.id = a.submission_id&#10;     ORDER BY a.created_at DESC&#10;     LIMIT 60`&#10;  );&#10;&#10;  const reports = await query&lt;ReportRow[]&gt;(&#10;    `SELECT r.*, &#10;            u.username AS reporter,&#10;            LEFT(s.text, 100) AS submission_text,&#10;            au.username AS submission_author&#10;     FROM submission_reports r&#10;     JOIN users u ON u.id = r.reporter_user_id&#10;     JOIN submissions s ON s.id = r.submission_id&#10;     JOIN users au ON au.id = s.user_id&#10;     WHERE r.status = 'pending'&#10;     ORDER BY r.created_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const categories = await query&lt;{ category: string }[]&gt;(&#10;    &quot;SELECT DISTINCT category FROM submissions ORDER BY category&quot;&#10;  );&#10;&#10;  const phaseSettings = await getPhaseSettings();&#10;&#10;  return (&#10;    &lt;div className=&quot;relative min-h-dvh overflow-hidden bg-gradient-to-br from-[#1a1714] via-[#221e1a] to-[#1a1714]&quot;&gt;&#10;      {/* Subtile Hintergrundeffekte */}&#10;      &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;        &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#e89a7a]/6 blur-3xl&quot; /&gt;&#10;        &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#8faf9d]/6 blur-3xl&quot; /&gt;&#10;      &lt;/div&gt;&#10;&#10;      &lt;div className=&quot;max-w-6xl mx-auto px-4 py-12 space-y-10&quot;&gt;&#10;        &lt;div className=&quot;text-center mb-12&quot;&gt;&#10;          &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#8faf9d]/10 border border-[#8faf9d]/20&quot;&gt;&#10;            &lt;Shield className=&quot;h-4 w-4 text-[#8faf9d]&quot; /&gt;&#10;            &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#8faf9d]&quot;&gt;&#10;              Admin-Bereich&#10;            &lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold text-[#f5f1ed] mb-4&quot;&gt;&#10;            Dashboard&#10;          &lt;/h1&gt;&#10;          &lt;p className=&quot;text-lg text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;            Moderiere Einsendungen, verwalte Accounts und behalte den Überblick.&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        {/* Statistiken */}&#10;        &lt;div className=&quot;grid gap-6 md:grid-cols-4&quot;&gt;&#10;          {[&#10;            { label: &quot;Gesamt&quot;, value: stats?.total || 0, icon: &lt;Users className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#d97757] to-[#c96846]&quot; },&#10;            { label: &quot;Ausstehend&quot;, value: stats?.pending || 0, icon: &lt;Clock className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#b8957a] to-[#a88568]&quot; },&#10;            { label: &quot;Genehmigt&quot;, value: stats?.approved || 0, icon: &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#7a9b88] to-[#6a8b78]&quot; },&#10;            { label: &quot;Gelöscht&quot;, value: stats?.deleted || 0, icon: &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#c96846] to-[#b85836]&quot; },&#10;          ].map((s, i) =&gt; (&#10;            &lt;GlassCard key={s.label} delay={i * 0.06}&gt;&#10;              &lt;div className=&quot;flex items-center gap-4&quot;&gt;&#10;                &lt;div className={`h-12 w-12 rounded-2xl bg-gradient-to-br ${s.color} flex items-center justify-center text-white shadow-lg`}&gt;&#10;                  {s.icon}&#10;                &lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#b8aea5]&quot;&gt;{s.label}&lt;/div&gt;&#10;                  &lt;div className=&quot;text-2xl font-bold text-[#f5f1ed]&quot;&gt;{s.value}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          ))}&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid lg:grid-cols-3 gap-8&quot;&gt;&#10;          {/* Moderationsliste */}&#10;          &lt;div className=&quot;lg:col-span-2 space-y-8&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                    &lt;FileText className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Ausstehende Einsendungen&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Prüfen, genehmigen oder löschen.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {/* Filter */}&#10;              &lt;form method=&quot;GET&quot; className=&quot;mb-6 flex flex-wrap items-center gap-3&quot;&gt;&#10;                &lt;input&#10;                  type=&quot;text&quot;&#10;                  name=&quot;q&quot;&#10;                  defaultValue={q}&#10;                  placeholder=&quot;Suche Text/Autor/Name&quot;&#10;                  className=&quot;input-base flex-1 min-w-[200px]&quot;&#10;                /&gt;&#10;                &lt;select&#10;                  name=&quot;category&quot;&#10;                  defaultValue={category}&#10;                  className=&quot;input-base min-w-[160px]&quot;&#10;                &gt;&#10;                  &lt;option value=&quot;&quot;&gt;Alle Kategorien&lt;/option&gt;&#10;                  {categories.map((c) =&gt; (&#10;                    &lt;option key={c.category} value={c.category}&gt;{c.category}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-5&quot;&gt;Filtern&lt;/GlowButton&gt;&#10;                &lt;a href=&quot;/admin&quot; className=&quot;text-sm text-[#e89a7a] hover:underline&quot;&gt;Zurücksetzen&lt;/a&gt;&#10;              &lt;/form&gt;&#10;&#10;              {pending.length === 0 ? (&#10;                &lt;div className=&quot;text-center py-12&quot;&gt;&#10;                  &lt;div className=&quot;inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-[#8faf9d]/10 text-[#8faf9d] mb-4&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-8 w-8&quot; /&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Keine ausstehenden Einsendungen. Alles erledigt! ✨&lt;/p&gt;&#10;                &lt;/div&gt;&#10;              ) : (&#10;                &lt;form&gt;&#10;                  &lt;div className=&quot;mb-4 flex items-center justify-end gap-3&quot;&gt;&#10;                    &lt;GlowButton&#10;                      formAction={approveManySubmissionsAction}&#10;                      variant=&quot;primary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl genehmigen&#10;                    &lt;/GlowButton&gt;&#10;                    &lt;GlowButton&#10;                      formAction={deleteManySubmissionsAction}&#10;                      variant=&quot;secondary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl löschen&#10;                    &lt;/GlowButton&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;div className=&quot;space-y-4&quot;&gt;&#10;                    {pending.map((p) =&gt; (&#10;                      &lt;div key={p.id} className=&quot;rounded-2xl border border-[#e89a7a]/15 bg-[#2a2520]/80 p-5 hover:border-[#e89a7a]/25 transition-all&quot;&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                          &lt;div className=&quot;flex items-start gap-4 flex-1&quot;&gt;&#10;                            &lt;input&#10;                              type=&quot;checkbox&quot;&#10;                              name=&quot;ids&quot;&#10;                              value={p.id}&#10;                              className=&quot;mt-1.5 h-5 w-5 rounded border-[#e89a7a]/30 text-[#e89a7a] focus:ring-[#d97757]/50&quot;&#10;                            /&gt;&#10;                            &lt;div className=&quot;flex-1&quot;&gt;&#10;                              &lt;div className=&quot;text-xs text-[#b8aea5] flex flex-wrap items-center gap-2 mb-3&quot;&gt;&#10;                                &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&#10;                                  &lt;User2 className=&quot;h-3.5 w-3.5 text-[#8faf9d]&quot; /&gt;&#10;                                  &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt;{p.author}&lt;/strong&gt;&#10;                                &lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span&gt;{new Date(p.created_at).toLocaleString(&quot;de-DE&quot;)}&lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#e89a7a]/10 text-[#e89a7a] text-xs font-medium border border-[#e89a7a]/20&quot;&gt;&#10;                                  {p.category}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                              &lt;div className=&quot;text-sm text-[#f5f1ed] leading-relaxed whitespace-pre-wrap&quot;&gt;&#10;                                {p.text}&#10;                              &lt;/div&gt;&#10;                              {(p.name || p.phone) &amp;&amp; (&#10;                                &lt;div className=&quot;mt-3 pt-3 border-t border-[#e89a7a]/10 text-xs text-[#b8aea5]&quot;&gt;&#10;                                  {[p.name, p.phone].filter(Boolean).join(&quot; · &quot;)}&#10;                                &lt;/div&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;shrink-0 flex flex-col gap-2&quot;&gt;&#10;                            &lt;form action={approveSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;primary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Genehmigen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                            &lt;form action={deleteSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;secondary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Löschen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    ))}&#10;                  &lt;/div&gt;&#10;                &lt;/form&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#8faf9d]/10 text-[#8faf9d]&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Genehmigt (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {approved.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Noch nichts genehmigt.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {approved.map((a) =&gt; (&#10;                    &lt;div key={a.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#8faf9d]/15 bg-[#8faf9d]/5 p-4 hover:border-[#8faf9d]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;strong&gt;{a.author}&lt;/strong&gt; • {a.category} • genehmigt von &lt;strong&gt;{a.approver || &quot;—&quot;}&lt;/strong&gt; am {a.approved_at ? new Date(a.approved_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap&quot;&gt;{a.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={deleteSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={a.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;secondary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;Trash2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Löschen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 text-[#d97757]&quot;&gt;&#10;                    &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Gelöscht (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {deleted.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Keine gelöschten Beiträge.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {deleted.map((d) =&gt; (&#10;                    &lt;div key={d.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#d97757]/15 bg-[#d97757]/5 p-4 hover:border-[#d97757]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;strong&gt;{d.author}&lt;/strong&gt; • {d.category} • gelöscht von &lt;strong&gt;{d.deleter || &quot;—&quot;}&lt;/strong&gt; am {d.deleted_at ? new Date(d.deleted_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap opacity-75&quot;&gt;{d.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={restoreSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={d.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;primary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;RotateCcw className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Wiederherstellen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-red-400/10 text-red-400&quot;&gt;&#10;                    &lt;Flag className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Gemeldete Beiträge&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;User-Meldungen prüfen und bearbeiten.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;ReportsList reports={reports} /&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;&#10;          {/* Sidebar */}&#10;          &lt;div className=&quot;lg:col-span-1 space-y-6&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#8faf9d]/10 text-[#8faf9d]&quot;&gt;&#10;                    &lt;Shield className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Schnellzugriff&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3&quot;&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Zur Startseite&#10;                &lt;/GlowButton&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/phase-1&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Beitrag einreichen&#10;                &lt;/GlowButton&gt;&#10;                {isAdmin &amp;&amp; (&#10;                  &lt;GlowButton&#10;                    as=&quot;a&quot;&#10;                    href=&quot;/admin/user&quot;&#10;                    variant=&quot;primary&quot;&#10;                    className=&quot;w-full justify-start&quot;&#10;                    iconLeft={&lt;Users className=&quot;h-4 w-4&quot; /&gt;}&#10;                  &gt;&#10;                    Benutzerverwaltung&#10;                  &lt;/GlowButton&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                    &lt;Activity className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Aktivitätsprotokoll&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[500px] overflow-y-auto&quot;&gt;&#10;                {audit.slice(0, 20).map((log) =&gt; (&#10;                  &lt;div key={log.id} className=&quot;text-xs&quot;&gt;&#10;                    &lt;div className=&quot;flex items-center gap-2 text-[#b8aea5]&quot;&gt;&#10;                      &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                        log.action === 'create' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'approve' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'delete' ? 'bg-[#c96846]' :&#10;                        'bg-[#d97757]'&#10;                      }`} /&gt;&#10;                      &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt;{log.actor}&lt;/strong&gt;&#10;                      &lt;span&gt;•&lt;/span&gt;&#10;                      &lt;span&gt;{log.action === 'create' ? 'erstellt' : log.action === 'approve' ? 'genehmigt' : log.action === 'delete' ? 'gelöscht' : 'wiederhergestellt'}&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;mt-1 text-[#b8aea5] line-clamp-2 pl-4&quot;&gt;&#10;                      {log.preview}...&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;text-[#b8aea7] opacity-60 pl-4 mt-0.5&quot;&gt;&#10;                      {new Date(log.created_at).toLocaleString(&quot;de-DE&quot;)}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            {/* Phase Control Panel (only for admins) */}&#10;            {isAdmin &amp;&amp; (&#10;              &lt;GlassCard&#10;                header={&#10;                  &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                    &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#66bb6a]/10 text-[#66bb6a]&quot;&gt;&#10;                      &lt;Layers className=&quot;h-5 w-5&quot; /&gt;&#10;                    &lt;/span&gt;&#10;                    &lt;div&gt;&#10;                      &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Phasensteuerung&lt;/h3&gt;&#10;                      &lt;p className=&quot;text-xs text-[#b8aea5]&quot;&gt;Aktiviere/Deaktiviere Phasen für User&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                }&#10;              &gt;&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {phaseSettings.map((phase) =&gt; {&#10;                    const isDevelopment = phase.status === 'development';&#10;&#10;                    return (&#10;                      &lt;div key={phase.id} className={`rounded-xl border ${&#10;                        phase.enabled &#10;                          ? 'border-[#66bb6a]/20 bg-[#66bb6a]/5' &#10;                          : isDevelopment&#10;                          ? 'border-[#ffb74d]/20 bg-[#ffb74d]/5'&#10;                          : 'border-[#b8aea5]/20 bg-[#b8aea5]/5'&#10;                      } p-4 transition-all`}&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-3 mb-3&quot;&gt;&#10;                          &lt;div className=&quot;flex-1&quot;&gt;&#10;                            &lt;div className=&quot;flex items-center gap-2 mb-1&quot;&gt;&#10;                              &lt;div className=&quot;text-sm font-semibold text-[#f5f1ed]&quot;&gt;&#10;                                {phase.title}&#10;                              &lt;/div&gt;&#10;                              {isDevelopment &amp;&amp; (&#10;                                &lt;span className=&quot;inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[#ffb74d]/10 text-[#ffb74d] text-xs font-medium border border-[#ffb74d]/20&quot;&gt;&#10;                                  &lt;Wrench className=&quot;h-3 w-3&quot; /&gt;&#10;                                  In Entwicklung&#10;                                &lt;/span&gt;&#10;                              )}&#10;                              {!isDevelopment &amp;&amp; (&#10;                                &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                                  phase.enabled ? 'bg-[#4caf50] animate-pulse' : 'bg-[#f44336]'&#10;                                }`} /&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                            &lt;p className=&quot;text-xs text-[#b8aea5]&quot;&gt;&#10;                              {phase.description}&#10;                            &lt;/p&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        {isDevelopment ? (&#10;                          &lt;div className=&quot;rounded-lg bg-[#ffb74d]/10 border border-[#ffb74d]/20 px-4 py-3 text-center&quot;&gt;&#10;                            &lt;span className=&quot;text-xs font-medium text-[#ffb74d]&quot;&gt;&#10;                              Diese Phase ist noch nicht fertig und kann nicht aktiviert werden&#10;                            &lt;/span&gt;&#10;                          &lt;/div&gt;&#10;                        ) : (&#10;                          &lt;form action={togglePhaseAction}&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;phaseKey&quot; value={phase.phase_key} /&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;enabled&quot; value={phase.enabled ? 'false' : 'true'} /&gt;&#10;                            &lt;GlowButton&#10;                              variant={phase.enabled ? &quot;secondary&quot; : &quot;primary&quot;}&#10;                              className=&quot;w-full text-sm&quot;&#10;                              iconLeft={phase.enabled ? &lt;ToggleLeft className=&quot;h-4 w-4&quot; /&gt; : &lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                            &gt;&#10;                              {phase.enabled ? 'Deaktivieren' : 'Aktivieren'}&#10;                            &lt;/GlowButton&gt;&#10;                          &lt;/form&gt;&#10;                        )}&#10;                      &lt;/div&gt;&#10;                    );&#10;                  })}&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;mt-4 p-3 rounded-xl bg-[#64b5f6]/5 border border-[#64b5f6]/20&quot;&gt;&#10;                  &lt;div className=&quot;text-xs text-[#b8aea5]&quot;&gt;&#10;                    &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt; Info:&lt;/strong&gt; Admins können deaktivierte Phasen trotzdem betreten (Testzwecke).&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/GlassCard&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/admin/user/LoginLinkClient.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/admin/user/LoginLinkClient.tsx" />
              <option name="originalContent" value="&quot;use client&quot;;&#10;&#10;import { useState, useTransition } from &quot;react&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import { Copy, Download, ExternalLink, QrCode, CheckCircle2, RefreshCw, Share2, Mail, MessageCircle, Printer } from &quot;lucide-react&quot;;&#10;&#10;export default function LoginLinkClient({ userId }: { userId: number; username: string }) {&#10;  const [password, setPassword] = useState(&quot;&quot;);&#10;  const [result, setResult] = useState&lt;{ link: string; username: string; password: string } | null&gt;(null);&#10;  const [error, setError] = useState&lt;string | null&gt;(null);&#10;  const [isPending, startTransition] = useTransition();&#10;  const [copied, setCopied] = useState&lt;string | null&gt;(null);&#10;  const [showShareMenu, setShowShareMenu] = useState(false);&#10;&#10;  // Auto-generiere ein starkes Passwort&#10;  const generateStrongPassword = () =&gt; {&#10;    const chars = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&amp;*&quot;;&#10;    let pwd = &quot;&quot;;&#10;    for (let i = 0; i &lt; 12; i++) {&#10;      pwd += chars[Math.floor(Math.random() * chars.length)];&#10;    }&#10;    setPassword(pwd);&#10;  };&#10;&#10;  const generate = () =&gt; {&#10;    setError(null);&#10;    if (!password) {&#10;      setError(&quot;Passwort eingeben&quot;);&#10;      return;&#10;    }&#10;    startTransition(async () =&gt; {&#10;      try {&#10;        const res = await fetch(&quot;/api/admin/generate-login-link&quot;, {&#10;          method: &quot;POST&quot;,&#10;          headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },&#10;          body: JSON.stringify({ userId, password }),&#10;        });&#10;        const json = await res.json();&#10;        if (!json.success) {&#10;          setError(json.error || &quot;Fehler&quot;);&#10;          setResult(null);&#10;          return;&#10;        }&#10;        setResult({ link: json.link, username: json.username, password: json.password });&#10;        setPassword(&quot;&quot;);&#10;      } catch {&#10;        setError(&quot;Netzwerkfehler&quot;);&#10;      }&#10;    });&#10;  };&#10;&#10;  const copyToClipboard = async (text: string, label: string) =&gt; {&#10;    try {&#10;      await navigator.clipboard.writeText(text);&#10;      setCopied(label);&#10;      setTimeout(() =&gt; setCopied(null), 2000);&#10;    } catch {&#10;      alert(&quot;Kopieren fehlgeschlagen&quot;);&#10;    }&#10;  };&#10;&#10;  const copyAll = async () =&gt; {&#10;    if (!result) return;&#10;    const text = `Login-Daten für ${result.username}\n\nLogin-Link: ${result.link}\n\nUsername: ${result.username}\nPasswort: ${result.password}\n\nEinfach den Link öffnen oder QR-Code scannen!`;&#10;    await copyToClipboard(text, 'all');&#10;  };&#10;&#10;  const downloadQR = () =&gt; {&#10;    if (!result) return;&#10;    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=800x800&amp;data=${encodeURIComponent(result.link)}`;&#10;    const link = document.createElement('a');&#10;    link.href = qrUrl;&#10;    link.download = `login-qr-${result.username}.png`;&#10;    link.click();&#10;  };&#10;&#10;  const openInNewTab = () =&gt; {&#10;    if (!result) return;&#10;    window.open(result.link, '_blank');&#10;  };&#10;&#10;  const shareViaEmail = () =&gt; {&#10;    if (!result) return;&#10;    const subject = encodeURIComponent(`Login-Zugang für ${result.username}`);&#10;    const body = encodeURIComponent(`Hallo,\n\nhier sind deine Login-Daten:\n\nLogin-Link: ${result.link}\n\nUsername: ${result.username}\nPasswort: ${result.password}\n\nEinfach den Link öffnen oder QR-Code scannen!\n\nViel Erfolg!`);&#10;    window.location.href = `mailto:?subject=${subject}&amp;body=${body}`;&#10;  };&#10;&#10;  const shareViaWhatsApp = () =&gt; {&#10;    if (!result) return;&#10;    const text = encodeURIComponent(`Hier sind deine Login-Daten:\n\n ${result.link}\n\n Username: ${result.username}\n Passwort: ${result.password}\n\nEinfach Link öffnen! `);&#10;    window.open(`https://wa.me/?text=${text}`, '_blank');&#10;  };&#10;&#10;  const print = () =&gt; {&#10;    if (!result) return;&#10;    const printWindow = window.open('', '_blank');&#10;    if (!printWindow) return;&#10;&#10;    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=600x600&amp;data=${encodeURIComponent(result.link)}`;&#10;&#10;    printWindow.document.write(`&#10;      &lt;!DOCTYPE html&gt;&#10;      &lt;html&gt;&#10;        &lt;head&gt;&#10;          &lt;title&gt;Login-Daten - ${result.username}&lt;/title&gt;&#10;          &lt;style&gt;&#10;            body { &#10;              font-family: system-ui, -apple-system, sans-serif; &#10;              max-width: 600px; &#10;              margin: 40px auto; &#10;              padding: 20px;&#10;              line-height: 1.6;&#10;            }&#10;            h1 { color: #d97757; margin-bottom: 30px; }&#10;            .box { &#10;              border: 2px solid #d97757; &#10;              border-radius: 12px; &#10;              padding: 20px; &#10;              margin: 20px 0;&#10;              background: #faf8f5;&#10;            }&#10;            .label { &#10;              font-weight: bold; &#10;              color: #6b635a; &#10;              font-size: 12px;&#10;              text-transform: uppercase;&#10;              margin-bottom: 8px;&#10;            }&#10;            .value { &#10;              font-size: 16px; &#10;              color: #2a2520;&#10;              padding: 12px;&#10;              background: white;&#10;              border-radius: 8px;&#10;              margin-bottom: 16px;&#10;              word-break: break-all;&#10;            }&#10;            .qr { &#10;              text-align: center; &#10;              margin: 30px 0;&#10;            }&#10;            .qr img { &#10;              max-width: 300px; &#10;              border: 2px solid #d97757;&#10;              border-radius: 12px;&#10;              padding: 20px;&#10;              background: white;&#10;            }&#10;            .footer { &#10;              margin-top: 40px; &#10;              padding-top: 20px; &#10;              border-top: 2px solid #e5e5e5;&#10;              color: #6b635a; &#10;              font-size: 14px;&#10;            }&#10;            @media print {&#10;              body { margin: 0; }&#10;            }&#10;          &lt;/style&gt;&#10;        &lt;/head&gt;&#10;        &lt;body&gt;&#10;          &lt;h1&gt; Jahrbuch Login-Daten&lt;/h1&gt;&#10;          &#10;          &lt;div class=&quot;qr&quot;&gt;&#10;            &lt;img src=&quot;${qrUrl}&quot; alt=&quot;QR Code&quot; /&gt;&#10;            &lt;p style=&quot;margin-top: 12px; color: #6b635a;&quot;&gt;QR-Code scannen für direkten Login&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &#10;          &lt;div class=&quot;box&quot;&gt;&#10;            &lt;div class=&quot;label&quot;&gt;Login-Link&lt;/div&gt;&#10;            &lt;div class=&quot;value&quot;&gt;${result.link}&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;label&quot;&gt;Username&lt;/div&gt;&#10;            &lt;div class=&quot;value&quot;&gt;${result.username}&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;label&quot;&gt;Passwort&lt;/div&gt;&#10;            &lt;div class=&quot;value&quot;&gt;${result.password}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &#10;          &lt;div class=&quot;footer&quot;&gt;&#10;            &lt;strong&gt; So funktioniert&amp;apos;s:&lt;/strong&gt;&#10;            &lt;ul&gt;&#10;              &lt;li&gt;Scanne den QR-Code mit deinem Smartphone&lt;/li&gt;&#10;              &lt;li&gt;Oder öffne den Login-Link im Browser&lt;/li&gt;&#10;              &lt;li&gt;Die Zugangsdaten werden automatisch ausgefüllt&lt;/li&gt;&#10;            &lt;/ul&gt;&#10;          &lt;/div&gt;&#10;          &#10;          &lt;script&gt;&#10;            window.onload = () =&gt; {&#10;              setTimeout(() =&gt; window.print(), 500);&#10;            };&#10;          &lt;/script&gt;&#10;        &lt;/body&gt;&#10;      &lt;/html&gt;&#10;    `);&#10;    printWindow.document.close();&#10;  };&#10;&#10;  const qrUrl = result ? `https://api.qrserver.com/v1/create-qr-code/?size=280x280&amp;data=${encodeURIComponent(result.link)}` : null;&#10;&#10;  return (&#10;    &lt;div className=&quot;space-y-4&quot;&gt;&#10;      &lt;div className=&quot;flex flex-col sm:flex-row gap-3&quot;&gt;&#10;        &lt;div className=&quot;flex-1 flex gap-2&quot;&gt;&#10;          &lt;input&#10;            value={password}&#10;            onChange={(e) =&gt; setPassword(e.target.value)}&#10;            onKeyDown={(e) =&gt; e.key === 'Enter' &amp;&amp; generate()}&#10;            placeholder=&quot;Passwort für Link&quot;&#10;            type=&quot;text&quot;&#10;            className=&quot;input-base flex-1 text-sm&quot;&#10;          /&gt;&#10;          &lt;GlowButton&#10;            onClick={generateStrongPassword}&#10;            variant=&quot;ghost&quot;&#10;            className=&quot;px-3 py-2 text-xs shrink-0&quot;&#10;            title=&quot;Zufälliges Passwort generieren&quot;&#10;          &gt;&#10;            &#10;          &lt;/GlowButton&gt;&#10;        &lt;/div&gt;&#10;        &lt;GlowButton&#10;          onClick={generate}&#10;          loading={isPending}&#10;          variant=&quot;primary&quot;&#10;          className=&quot;px-5 py-2.5 text-sm whitespace-nowrap&quot;&#10;          iconLeft={&lt;QrCode className=&quot;h-4 w-4&quot; /&gt;}&#10;        &gt;&#10;          Link erzeugen&#10;        &lt;/GlowButton&gt;&#10;      &lt;/div&gt;&#10;&#10;      {error &amp;&amp; (&#10;        &lt;div className=&quot;rounded-xl bg-[#c96846]/10 dark:bg-[#d97757]/10 border border-[#c96846]/30 dark:border-[#d97757]/30 px-4 py-3&quot;&gt;&#10;          &lt;div className=&quot;text-sm text-[#c96846] dark:text-[#d97757] font-medium&quot;&gt;{error}&lt;/div&gt;&#10;        &lt;/div&gt;&#10;      )}&#10;&#10;      {result &amp;&amp; (&#10;        &lt;div className=&quot;rounded-2xl bg-gradient-to-br from-white/80 to-white/60 dark:from-[#2a2520]/80 dark:to-[#2a2520]/60 backdrop-blur-sm border border-[#d97757]/20 dark:border-[#e89a7a]/20 p-6 space-y-5 shadow-lg shadow-[#d97757]/10&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between flex-wrap gap-3&quot;&gt;&#10;            &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;              &lt;div className=&quot;h-10 w-10 rounded-xl bg-gradient-to-br from-[#7a9b88] to-[#6a8b78] flex items-center justify-center text-white shadow-md&quot;&gt;&#10;                &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;div className=&quot;text-sm font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Login-Link erstellt&lt;/div&gt;&#10;                &lt;div className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Für {result.username}&lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div className=&quot;flex gap-2&quot;&gt;&#10;              &lt;div className=&quot;relative&quot;&gt;&#10;                &lt;GlowButton&#10;                  onClick={() =&gt; setShowShareMenu(!showShareMenu)}&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;px-3 py-2 text-xs&quot;&#10;                  iconLeft={&lt;Share2 className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                &gt;&#10;                  Teilen&#10;                &lt;/GlowButton&gt;&#10;                {showShareMenu &amp;&amp; (&#10;                  &lt;div className=&quot;absolute right-0 top-full mt-2 w-48 rounded-xl bg-white dark:bg-[#2a2520] border border-[#d97757]/20 dark:border-[#e89a7a]/20 shadow-xl z-50 overflow-hidden&quot;&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { shareViaEmail(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#d97757]/10 dark:hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#2a2520] dark:text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;Mail className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Per E-Mail&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { shareViaWhatsApp(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#d97757]/10 dark:hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#2a2520] dark:text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;MessageCircle className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Per WhatsApp&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { copyAll(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#d97757]/10 dark:hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#2a2520] dark:text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;Copy className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Alles kopieren&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { print(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#d97757]/10 dark:hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#2a2520] dark:text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;Printer className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Drucken&#10;                    &lt;/button&gt;&#10;                  &lt;/div&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;              &lt;GlowButton&#10;                onClick={() =&gt; setResult(null)}&#10;                variant=&quot;ghost&quot;&#10;                className=&quot;px-3 py-2 text-xs&quot;&#10;                iconLeft={&lt;RefreshCw className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;              &gt;&#10;                Neu&#10;              &lt;/GlowButton&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div className=&quot;grid md:grid-cols-[auto,1fr] gap-6 items-start&quot;&gt;&#10;            {qrUrl &amp;&amp; (&#10;              &lt;div className=&quot;flex flex-col items-center gap-3&quot;&gt;&#10;                &lt;div className=&quot;rounded-2xl bg-white p-4 shadow-lg ring-1 ring-[#d97757]/20 dark:ring-[#e89a7a]/20&quot;&gt;&#10;                  {/* eslint-disable-next-line @next/next/no-img-element */}&#10;                  &lt;img&#10;                    src={qrUrl}&#10;                    alt=&quot;Login QR Code&quot;&#10;                    className=&quot;w-[280px] h-[280px] rounded-xl&quot;&#10;                  /&gt;&#10;                &lt;/div&gt;&#10;                &lt;GlowButton&#10;                  onClick={downloadQR}&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;px-4 py-2 text-xs w-full&quot;&#10;                  iconLeft={&lt;Download className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                &gt;&#10;                  QR-Code laden&#10;                &lt;/GlowButton&gt;&#10;              &lt;/div&gt;&#10;            )}&#10;&#10;            &lt;div className=&quot;space-y-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-2&quot;&gt;&#10;                &lt;div className=&quot;text-xs font-medium text-[#6b635a] dark:text-[#b8aea5] uppercase tracking-wide&quot;&gt;Login-Link&lt;/div&gt;&#10;                &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                  &lt;div className=&quot;flex-1 rounded-xl bg-[#7a9b88]/5 dark:bg-[#8faf9d]/5 border border-[#7a9b88]/20 dark:border-[#8faf9d]/20 px-4 py-3&quot;&gt;&#10;                    &lt;a&#10;                      href={result.link}&#10;                      target=&quot;_blank&quot;&#10;                      rel=&quot;noopener noreferrer&quot;&#10;                      className=&quot;text-sm text-[#7a9b88] dark:text-[#8faf9d] hover:text-[#6a8b78] dark:hover:text-[#7a9b88] break-all font-medium hover:underline&quot;&#10;                    &gt;&#10;                      {result.link}&#10;                    &lt;/a&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;flex gap-2&quot;&gt;&#10;                  &lt;GlowButton&#10;                    onClick={() =&gt; copyToClipboard(result.link, 'link')}&#10;                    variant={copied === 'link' ? 'primary' : 'secondary'}&#10;                    className=&quot;px-3 py-2 text-xs flex-1&quot;&#10;                    iconLeft={copied === 'link' ? &lt;CheckCircle2 className=&quot;h-3.5 w-3.5&quot; /&gt; : &lt;Copy className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                  &gt;&#10;                    {copied === 'link' ? 'Kopiert!' : 'Link kopieren'}&#10;                  &lt;/GlowButton&gt;&#10;                  &lt;GlowButton&#10;                    onClick={openInNewTab}&#10;                    variant=&quot;ghost&quot;&#10;                    className=&quot;px-3 py-2 text-xs&quot;&#10;                    iconLeft={&lt;ExternalLink className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                  &gt;&#10;                    Öffnen&#10;                  &lt;/GlowButton&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;grid grid-cols-2 gap-3&quot;&gt;&#10;                &lt;div className=&quot;space-y-1.5&quot;&gt;&#10;                  &lt;div className=&quot;text-xs font-medium text-[#6b635a] dark:text-[#b8aea5] uppercase tracking-wide&quot;&gt;Username&lt;/div&gt;&#10;                  &lt;div className=&quot;rounded-xl bg-white/60 dark:bg-[#1a1714]/60 border border-[#d97757]/15 dark:border-[#e89a7a]/15 px-3 py-2.5&quot;&gt;&#10;                    &lt;div className=&quot;text-sm font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{result.username}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;GlowButton&#10;                    onClick={() =&gt; copyToClipboard(result.username, 'username')}&#10;                    variant=&quot;ghost&quot;&#10;                    className=&quot;px-2 py-1.5 text-xs w-full&quot;&#10;                    iconLeft={copied === 'username' ? &lt;CheckCircle2 className=&quot;h-3 w-3&quot; /&gt; : &lt;Copy className=&quot;h-3 w-3&quot; /&gt;}&#10;                  &gt;&#10;                    {copied === 'username' ? 'Kopiert!' : 'Kopieren'}&#10;                  &lt;/GlowButton&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;space-y-1.5&quot;&gt;&#10;                  &lt;div className=&quot;text-xs font-medium text-[#6b635a] dark:text-[#b8aea5] uppercase tracking-wide&quot;&gt;Passwort&lt;/div&gt;&#10;                  &lt;div className=&quot;rounded-xl bg-white/60 dark:bg-[#1a1714]/60 border border-[#d97757]/15 dark:border-[#e89a7a]/15 px-3 py-2.5&quot;&gt;&#10;                    &lt;div className=&quot;text-sm font-mono font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{result.password}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;GlowButton&#10;                    onClick={() =&gt; copyToClipboard(result.password, 'password')}&#10;                    variant=&quot;ghost&quot;&#10;                    className=&quot;px-2 py-1.5 text-xs w-full&quot;&#10;                    iconLeft={copied === 'password' ? &lt;CheckCircle2 className=&quot;h-3 w-3&quot; /&gt; : &lt;Copy className=&quot;h-3 w-3&quot; /&gt;}&#10;                  &gt;&#10;                    {copied === 'password' ? 'Kopiert!' : 'Kopieren'}&#10;                  &lt;/GlowButton&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;rounded-xl bg-[#d97757]/5 dark:bg-[#e89a7a]/5 border border-[#d97757]/20 dark:border-[#e89a7a]/20 px-4 py-3&quot;&gt;&#10;                &lt;div className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5] space-y-1&quot;&gt;&#10;                  &lt;div className=&quot;font-medium text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt; Hinweise:&lt;/div&gt;&#10;                  &lt;div&gt;• QR-Code scannen für sofortigen Login&lt;/div&gt;&#10;                  &lt;div&gt;• Link funktioniert auf allen Geräten&lt;/div&gt;&#10;                  &lt;div&gt;• Login-Daten können mehrfach genutzt werden&lt;/div&gt;&#10;                  &lt;div&gt;• Über &amp;quot;Teilen&amp;quot; Button versenden oder drucken&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      )}&#10;&#10;      {/* Click außerhalb schließt Share-Menü */}&#10;      {showShareMenu &amp;&amp; (&#10;        &lt;div&#10;          className=&quot;fixed inset-0 z-40&quot;&#10;          onClick={() =&gt; setShowShareMenu(false)}&#10;        /&gt;&#10;      )}&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="&quot;use client&quot;;&#10;&#10;import { useState, useTransition } from &quot;react&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import { Copy, Download, ExternalLink, QrCode, CheckCircle2, RefreshCw, Share2, Mail, MessageCircle, Printer } from &quot;lucide-react&quot;;&#10;&#10;export default function LoginLinkClient({ userId }: { userId: number; username: string }) {&#10;  const [password, setPassword] = useState(&quot;&quot;);&#10;  const [result, setResult] = useState&lt;{ link: string; username: string; password: string } | null&gt;(null);&#10;  const [error, setError] = useState&lt;string | null&gt;(null);&#10;  const [isPending, startTransition] = useTransition();&#10;  const [copied, setCopied] = useState&lt;string | null&gt;(null);&#10;  const [showShareMenu, setShowShareMenu] = useState(false);&#10;&#10;  // Auto-generiere ein starkes Passwort&#10;  const generateStrongPassword = () =&gt; {&#10;    const chars = &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%&amp;*&quot;;&#10;    let pwd = &quot;&quot;;&#10;    for (let i = 0; i &lt; 12; i++) {&#10;      pwd += chars[Math.floor(Math.random() * chars.length)];&#10;    }&#10;    setPassword(pwd);&#10;  };&#10;&#10;  const generate = () =&gt; {&#10;    setError(null);&#10;    if (!password) {&#10;      setError(&quot;Passwort eingeben&quot;);&#10;      return;&#10;    }&#10;    startTransition(async () =&gt; {&#10;      try {&#10;        const res = await fetch(&quot;/api/admin/generate-login-link&quot;, {&#10;          method: &quot;POST&quot;,&#10;          headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },&#10;          body: JSON.stringify({ userId, password }),&#10;        });&#10;        const json = await res.json();&#10;        if (!json.success) {&#10;          setError(json.error || &quot;Fehler&quot;);&#10;          setResult(null);&#10;          return;&#10;        }&#10;        setResult({ link: json.link, username: json.username, password: json.password });&#10;        setPassword(&quot;&quot;);&#10;      } catch {&#10;        setError(&quot;Netzwerkfehler&quot;);&#10;      }&#10;    });&#10;  };&#10;&#10;  const copyToClipboard = async (text: string, label: string) =&gt; {&#10;    try {&#10;      await navigator.clipboard.writeText(text);&#10;      setCopied(label);&#10;      setTimeout(() =&gt; setCopied(null), 2000);&#10;    } catch {&#10;      alert(&quot;Kopieren fehlgeschlagen&quot;);&#10;    }&#10;  };&#10;&#10;  const copyAll = async () =&gt; {&#10;    if (!result) return;&#10;    const text = `Login-Daten für ${result.username}\n\nLogin-Link: ${result.link}\n\nUsername: ${result.username}\nPasswort: ${result.password}\n\nEinfach den Link öffnen oder QR-Code scannen!`;&#10;    await copyToClipboard(text, 'all');&#10;  };&#10;&#10;  const downloadQR = () =&gt; {&#10;    if (!result) return;&#10;    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=800x800&amp;data=${encodeURIComponent(result.link)}`;&#10;    const link = document.createElement('a');&#10;    link.href = qrUrl;&#10;    link.download = `login-qr-${result.username}.png`;&#10;    link.click();&#10;  };&#10;&#10;  const openInNewTab = () =&gt; {&#10;    if (!result) return;&#10;    window.open(result.link, '_blank');&#10;  };&#10;&#10;  const shareViaEmail = () =&gt; {&#10;    if (!result) return;&#10;    const subject = encodeURIComponent(`Login-Zugang für ${result.username}`);&#10;    const body = encodeURIComponent(`Hallo,\n\nhier sind deine Login-Daten:\n\nLogin-Link: ${result.link}\n\nUsername: ${result.username}\nPasswort: ${result.password}\n\nEinfach den Link öffnen oder QR-Code scannen!\n\nViel Erfolg!`);&#10;    window.location.href = `mailto:?subject=${subject}&amp;body=${body}`;&#10;  };&#10;&#10;  const shareViaWhatsApp = () =&gt; {&#10;    if (!result) return;&#10;    const text = encodeURIComponent(`Hier sind deine Login-Daten:\n\n ${result.link}\n\n Username: ${result.username}\n Passwort: ${result.password}\n\nEinfach Link öffnen! `);&#10;    window.open(`https://wa.me/?text=${text}`, '_blank');&#10;  };&#10;&#10;  const print = () =&gt; {&#10;    if (!result) return;&#10;    const printWindow = window.open('', '_blank');&#10;    if (!printWindow) return;&#10;&#10;    const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=600x600&amp;data=${encodeURIComponent(result.link)}`;&#10;&#10;    printWindow.document.write(`&#10;      &lt;!DOCTYPE html&gt;&#10;      &lt;html lang=&quot;de&quot;&gt;&#10;        &lt;head&gt;&#10;          &lt;meta charSet=&quot;utf-8&quot; /&gt;&#10;          &lt;title&gt;Login-Daten - ${result.username}&lt;/title&gt;&#10;          &lt;style&gt;&#10;            body { &#10;              font-family: system-ui, -apple-system, sans-serif; &#10;              max-width: 600px; &#10;              margin: 40px auto; &#10;              padding: 20px;&#10;              line-height: 1.6;&#10;            }&#10;            h1 { color: #d97757; margin-bottom: 30px; }&#10;            .box { &#10;              border: 2px solid #d97757; &#10;              border-radius: 12px; &#10;              padding: 20px; &#10;              margin: 20px 0;&#10;              background: #faf8f5;&#10;            }&#10;            .label { &#10;              font-weight: bold; &#10;              color: #6b635a; &#10;              font-size: 12px;&#10;              text-transform: uppercase;&#10;              margin-bottom: 8px;&#10;            }&#10;            .value { &#10;              font-size: 16px; &#10;              color: #2a2520;&#10;              padding: 12px;&#10;              background: white;&#10;              border-radius: 8px;&#10;              margin-bottom: 16px;&#10;              word-break: break-all;&#10;            }&#10;            .qr { &#10;              text-align: center; &#10;              margin: 30px 0;&#10;            }&#10;            .qr img { &#10;              max-width: 300px; &#10;              border: 2px solid #d97757;&#10;              border-radius: 12px;&#10;              padding: 20px;&#10;              background: white;&#10;            }&#10;            .footer { &#10;              margin-top: 40px; &#10;              padding-top: 20px; &#10;              border-top: 2px solid #e5e5e5;&#10;              color: #6b635a; &#10;              font-size: 14px;&#10;            }&#10;            @media print {&#10;              body { margin: 0; }&#10;            }&#10;          &lt;/style&gt;&#10;        &lt;/head&gt;&#10;        &lt;body&gt;&#10;          &lt;h1&gt; Jahrbuch Login-Daten&lt;/h1&gt;&#10;          &#10;          &lt;div class=&quot;qr&quot;&gt;&#10;            &lt;img src=&quot;${qrUrl}&quot; alt=&quot;QR Code&quot; /&gt;&#10;            &lt;p style=&quot;margin-top: 12px; color: #6b635a;&quot;&gt;QR-Code scannen für direkten Login&lt;/p&gt;&#10;          &lt;/div&gt;&#10;          &#10;          &lt;div class=&quot;box&quot;&gt;&#10;            &lt;div class=&quot;label&quot;&gt;Login-Link&lt;/div&gt;&#10;            &lt;div class=&quot;value&quot;&gt;${result.link}&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;label&quot;&gt;Username&lt;/div&gt;&#10;            &lt;div class=&quot;value&quot;&gt;${result.username}&lt;/div&gt;&#10;            &#10;            &lt;div class=&quot;label&quot;&gt;Passwort&lt;/div&gt;&#10;            &lt;div class=&quot;value&quot;&gt;${result.password}&lt;/div&gt;&#10;          &lt;/div&gt;&#10;          &#10;          &lt;div class=&quot;footer&quot;&gt;&#10;            &lt;strong&gt; So funktioniert's:&lt;/strong&gt;&#10;            &lt;ul&gt;&#10;              &lt;li&gt;Scanne den QR-Code mit deinem Smartphone&lt;/li&gt;&#10;              &lt;li&gt;Oder öffne den Login-Link im Browser&lt;/li&gt;&#10;              &lt;li&gt;Die Zugangsdaten werden automatisch ausgefüllt&lt;/li&gt;&#10;            &lt;/ul&gt;&#10;          &lt;/div&gt;&#10;          &#10;          &lt;script&gt;&#10;            window.onload = () =&gt; {&#10;              setTimeout(() =&gt; window.print(), 500);&#10;            };&#10;          &lt;/script&gt;&#10;        &lt;/body&gt;&#10;      &lt;/html&gt;&#10;    `);&#10;    printWindow.document.close();&#10;  };&#10;&#10;  const qrUrl = result ? `https://api.qrserver.com/v1/create-qr-code/?size=280x280&amp;data=${encodeURIComponent(result.link)}` : null;&#10;&#10;  return (&#10;    &lt;div className=&quot;space-y-4&quot;&gt;&#10;      &lt;div className=&quot;flex flex-col sm:flex-row gap-3&quot;&gt;&#10;        &lt;div className=&quot;flex-1 flex gap-2&quot;&gt;&#10;          &lt;input&#10;            value={password}&#10;            onChange={(e) =&gt; setPassword(e.target.value)}&#10;            onKeyDown={(e) =&gt; e.key === 'Enter' &amp;&amp; generate()}&#10;            placeholder=&quot;Passwort für Link&quot;&#10;            type=&quot;text&quot;&#10;            className=&quot;input-base flex-1 text-sm&quot;&#10;          /&gt;&#10;          &lt;GlowButton&#10;            onClick={generateStrongPassword}&#10;            variant=&quot;ghost&quot;&#10;            className=&quot;px-3 py-2 text-xs shrink-0&quot;&#10;            title=&quot;Zufälliges Passwort generieren&quot;&#10;          &gt;&#10;            &#10;          &lt;/GlowButton&gt;&#10;        &lt;/div&gt;&#10;        &lt;GlowButton&#10;          onClick={generate}&#10;          loading={isPending}&#10;          variant=&quot;primary&quot;&#10;          className=&quot;px-5 py-2.5 text-sm whitespace-nowrap&quot;&#10;          iconLeft={&lt;QrCode className=&quot;h-4 w-4&quot; /&gt;}&#10;        &gt;&#10;          Link erzeugen&#10;        &lt;/GlowButton&gt;&#10;      &lt;/div&gt;&#10;&#10;      {error &amp;&amp; (&#10;        &lt;div className=&quot;rounded-xl bg-[#d97757]/10 border border-[#d97757]/30 px-4 py-3&quot;&gt;&#10;          &lt;div className=&quot;text-sm text-[#d97757] font-medium&quot;&gt;{error}&lt;/div&gt;&#10;        &lt;/div&gt;&#10;      )}&#10;&#10;      {result &amp;&amp; (&#10;        &lt;div className=&quot;rounded-2xl bg-gradient-to-br from-[#2a2520]/80 to-[#2a2520]/60 backdrop-blur-sm border border-[#e89a7a]/20 p-6 space-y-5 shadow-lg shadow-[#d97757]/10&quot;&gt;&#10;          &lt;div className=&quot;flex items-center justify-between flex-wrap gap-3&quot;&gt;&#10;            &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;              &lt;div className=&quot;h-10 w-10 rounded-xl bg-gradient-to-br from-[#7a9b88] to-[#6a8b78] flex items-center justify-center text-white shadow-md&quot;&gt;&#10;                &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;&#10;              &lt;/div&gt;&#10;              &lt;div&gt;&#10;                &lt;div className=&quot;text-sm font-semibold text-[#f5f1ed]&quot;&gt;Login-Link erstellt&lt;/div&gt;&#10;                &lt;div className=&quot;text-xs text-[#b8aea5]&quot;&gt;Für {result.username}&lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;            &lt;div className=&quot;flex gap-2&quot;&gt;&#10;              &lt;div className=&quot;relative&quot;&gt;&#10;                &lt;GlowButton&#10;                  onClick={() =&gt; setShowShareMenu(!showShareMenu)}&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;px-3 py-2 text-xs&quot;&#10;                  iconLeft={&lt;Share2 className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                &gt;&#10;                  Teilen&#10;                &lt;/GlowButton&gt;&#10;                {showShareMenu &amp;&amp; (&#10;                  &lt;div className=&quot;absolute right-0 top-full mt-2 w-48 rounded-xl bg-[#2a2520] border border-[#e89a7a]/20 shadow-xl z-50 overflow-hidden&quot;&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { shareViaEmail(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;Mail className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Per E-Mail&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { shareViaWhatsApp(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;MessageCircle className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Per WhatsApp&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { copyAll(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;Copy className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Alles kopieren&#10;                    &lt;/button&gt;&#10;                    &lt;button&#10;                      onClick={() =&gt; { print(); setShowShareMenu(false); }}&#10;                      className=&quot;w-full px-4 py-3 text-left text-sm hover:bg-[#e89a7a]/10 flex items-center gap-3 text-[#f5f1ed] transition-colors&quot;&#10;                    &gt;&#10;                      &lt;Printer className=&quot;h-4 w-4 text-[#7a9b88]&quot; /&gt;&#10;                      Drucken&#10;                    &lt;/button&gt;&#10;                  &lt;/div&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;              &lt;GlowButton&#10;                onClick={() =&gt; setResult(null)}&#10;                variant=&quot;ghost&quot;&#10;                className=&quot;px-3 py-2 text-xs&quot;&#10;                iconLeft={&lt;RefreshCw className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;              &gt;&#10;                Neu&#10;              &lt;/GlowButton&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;div className=&quot;grid md:grid-cols-[auto,1fr] gap-6 items-start&quot;&gt;&#10;            {qrUrl &amp;&amp; (&#10;              &lt;div className=&quot;flex flex-col items-center gap-3&quot;&gt;&#10;                &lt;div className=&quot;rounded-2xl bg-white p-4 shadow-lg ring-1 ring-[#e89a7a]/20&quot;&gt;&#10;                  {/* eslint-disable-next-line @next/next/no-img-element */}&#10;                  &lt;img&#10;                    src={qrUrl}&#10;                    alt=&quot;Login QR Code&quot;&#10;                    className=&quot;w-[280px] h-[280px] rounded-xl&quot;&#10;                  /&gt;&#10;                &lt;/div&gt;&#10;                &lt;GlowButton&#10;                  onClick={downloadQR}&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;px-4 py-2 text-xs w-full&quot;&#10;                  iconLeft={&lt;Download className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                &gt;&#10;                  QR-Code laden&#10;                &lt;/GlowButton&gt;&#10;              &lt;/div&gt;&#10;            )}&#10;&#10;            &lt;div className=&quot;space-y-4&quot;&gt;&#10;              &lt;div className=&quot;space-y-2&quot;&gt;&#10;                &lt;div className=&quot;text-xs font-medium text-[#b8aea5] uppercase tracking-wide&quot;&gt;Login-Link&lt;/div&gt;&#10;                &lt;div className=&quot;flex items-center gap-2&quot;&gt;&#10;                  &lt;div className=&quot;flex-1 rounded-xl bg-[#8faf9d]/5 border border-[#8faf9d]/20 px-4 py-3&quot;&gt;&#10;                    &lt;a&#10;                      href={result!.link}&#10;                      target=&quot;_blank&quot;&#10;                      rel=&quot;noopener noreferrer&quot;&#10;                      className=&quot;text-sm text-[#8faf9d] hover:text-[#7a9b88] break-all font-medium hover:underline&quot;&#10;                    &gt;&#10;                      {result!.link}&#10;                    &lt;/a&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;flex gap-2&quot;&gt;&#10;                  &lt;GlowButton&#10;                    onClick={() =&gt; copyToClipboard(result!.link, 'link')}&#10;                    variant={copied === 'link' ? 'primary' : 'secondary'}&#10;                    className=&quot;px-3 py-2 text-xs flex-1&quot;&#10;                    iconLeft={copied === 'link' ? &lt;CheckCircle2 className=&quot;h-3.5 w-3.5&quot; /&gt; : &lt;Copy className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                  &gt;&#10;                    {copied === 'link' ? 'Kopiert!' : 'Link kopieren'}&#10;                  &lt;/GlowButton&gt;&#10;                  &lt;GlowButton&#10;                    onClick={openInNewTab}&#10;                    variant=&quot;ghost&quot;&#10;                    className=&quot;px-3 py-2 text-xs&quot;&#10;                    iconLeft={&lt;ExternalLink className=&quot;h-3.5 w-3.5&quot; /&gt;}&#10;                  &gt;&#10;                    Öffnen&#10;                  &lt;/GlowButton&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;grid grid-cols-2 gap-3&quot;&gt;&#10;                &lt;div className=&quot;space-y-1.5&quot;&gt;&#10;                  &lt;div className=&quot;text-xs font-medium text-[#b8aea5] uppercase tracking-wide&quot;&gt;Username&lt;/div&gt;&#10;                  &lt;div className=&quot;rounded-xl bg-[#1a1714]/60 border border-[#e89a7a]/15 px-3 py-2.5&quot;&gt;&#10;                    &lt;div className=&quot;text-sm font-semibold text-[#f5f1ed]&quot;&gt;{result!.username}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;GlowButton&#10;                    onClick={() =&gt; copyToClipboard(result!.username, 'username')}&#10;                    variant=&quot;ghost&quot;&#10;                    className=&quot;px-2 py-1.5 text-xs w-full&quot;&#10;                    iconLeft={copied === 'username' ? &lt;CheckCircle2 className=&quot;h-3 w-3&quot; /&gt; : &lt;Copy className=&quot;h-3 w-3&quot; /&gt;}&#10;                  &gt;&#10;                    {copied === 'username' ? 'Kopiert!' : 'Kopieren'}&#10;                  &lt;/GlowButton&gt;&#10;                &lt;/div&gt;&#10;&#10;                &lt;div className=&quot;space-y-1.5&quot;&gt;&#10;                  &lt;div className=&quot;text-xs font-medium text-[#b8aea5] uppercase tracking-wide&quot;&gt;Passwort&lt;/div&gt;&#10;                  &lt;div className=&quot;rounded-xl bg-[#1a1714]/60 border border-[#e89a7a]/15 px-3 py-2.5&quot;&gt;&#10;                    &lt;div className=&quot;text-sm font-mono font-semibold text-[#f5f1ed]&quot;&gt;{result!.password}&lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;GlowButton&#10;                    onClick={() =&gt; copyToClipboard(result!.password, 'password')}&#10;                    variant=&quot;ghost&quot;&#10;                    className=&quot;px-2 py-1.5 text-xs w-full&quot;&#10;                    iconLeft={copied === 'password' ? &lt;CheckCircle2 className=&quot;h-3 w-3&quot; /&gt; : &lt;Copy className=&quot;h-3 w-3&quot; /&gt;}&#10;                  &gt;&#10;                    {copied === 'password' ? 'Kopiert!' : 'Kopieren'}&#10;                  &lt;/GlowButton&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;&#10;              &lt;div className=&quot;rounded-xl bg-[#e89a7a]/5 border border-[#e89a7a]/20 px-4 py-3&quot;&gt;&#10;                &lt;div className=&quot;text-xs text-[#b8aea5] space-y-1&quot;&gt;&#10;                  &lt;div className=&quot;font-medium text-[#f5f1ed]&quot;&gt; Hinweise:&lt;/div&gt;&#10;                  &lt;div&gt;• QR-Code scannen für sofortigen Login&lt;/div&gt;&#10;                  &lt;div&gt;• Link funktioniert auf allen Geräten&lt;/div&gt;&#10;                  &lt;div&gt;• Login-Daten können mehrfach genutzt werden&lt;/div&gt;&#10;                  &lt;div&gt;• Über &amp;quot;Teilen&amp;quot; Button versenden oder drucken&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/div&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      )}&#10;&#10;      {/* Click außerhalb schließt Share-Menü */}&#10;      {showShareMenu &amp;&amp; (&#10;        &lt;div&#10;          className=&quot;fixed inset-0 z-40&quot;&#10;          onClick={() =&gt; setShowShareMenu(false)}&#10;        /&gt;&#10;      )}&#10;    &lt;/div&gt;&#10;  );&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/admin/user/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/admin/user/page.tsx" />
              <option name="originalContent" value="import { redirect } from &quot;next/navigation&quot;;&#10;import { getSession } from &quot;@/lib/session&quot;;&#10;import { query } from &quot;@/lib/db&quot;;&#10;import GlassCard from &quot;@/components/ui/GlassCard&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import LoginLinkClient from &quot;./LoginLinkClient&quot;;&#10;import { createUserAction, deleteUserAction, updateUserPasswordAction, updateUserRoleAction, banUserAction, unbanUserAction, banIpAction, unbanIpAction } from &quot;../actions&quot;;&#10;import { Users, Shield, KeyRound, UserPlus, Trash2, QrCode, Ban, ArrowLeft } from &quot;lucide-react&quot;;&#10;import { ensureUserClassColumn } from &quot;@/lib/migrations&quot;;&#10;import { CLASSES } from &quot;@/lib/constants&quot;;&#10;&#10;export const dynamic = &quot;force-dynamic&quot;;&#10;&#10;type UserRow = { id: number; username: string; role: &quot;user&quot; | &quot;moderator&quot; | &quot;admin&quot;; class: string | null };&#10;&#10;export default async function AdminUserPage({ searchParams }: { searchParams: Promise&lt;{ [key: string]: string | string[] | undefined }&gt; }) {&#10;  const session = await getSession();&#10;  if (!session) redirect(&quot;/login&quot;);&#10;  if (session.role !== &quot;admin&quot;) redirect(&quot;/zugriff-verweigert&quot;);&#10;&#10;  await ensureUserClassColumn();&#10;&#10;  const sp = await searchParams;&#10;  const q = typeof sp?.q === &quot;string&quot; ? sp.q.trim() : &quot;&quot;;&#10;  const classFilter = typeof sp?.class === &quot;string&quot; ? sp.class.trim() : &quot;&quot;;&#10;&#10;  const where: string[] = [];&#10;  const params: string[] = [];&#10;  if (q) { where.push(&quot;username LIKE ?&quot;); params.push(`%${q}%`); }&#10;  if (classFilter === &quot;none&quot;) { where.push(&quot;class IS NULL&quot;); }&#10;  else if (classFilter) { where.push(&quot;class = ?&quot;); params.push(classFilter); }&#10;  const whereSql = where.length ? `WHERE ${where.join(&quot; AND &quot;)}` : &quot;&quot;;&#10;&#10;  const users = await query&lt;UserRow[]&gt;(&#10;    `SELECT id, username, role, class FROM users ${whereSql} ORDER BY id DESC`,&#10;    params&#10;  );&#10;&#10;  const stats = {&#10;    total: users.length,&#10;    admins: users.filter((u) =&gt; u.role === 'admin').length,&#10;    moderators: users.filter((u) =&gt; u.role === 'moderator').length,&#10;    users: users.filter((u) =&gt; u.role === 'user').length,&#10;  };&#10;&#10;  const groups = [&#10;    { label: 'Ohne Klasse', items: users.filter((u) =&gt; !u.class) },&#10;    ...CLASSES.map((c) =&gt; ({ label: c, items: users.filter((u) =&gt; u.class === c) })),&#10;  ];&#10;&#10;  return (&#10;    &lt;div className=&quot;relative min-h-dvh overflow-hidden bg-gradient-to-br from-[#faf8f5] via-[#faf4ed] to-[#f5ede3] dark:from-[#1a1714] dark:via-[#221e1a] dark:to-[#1a1714]&quot;&gt;&#10;      &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;        &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#d97757]/8 dark:bg-[#e89a7a]/6 blur-3xl&quot; /&gt;&#10;        &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#7a9b88]/8 dark:bg-[#8faf9d]/6 blur-3xl&quot; /&gt;&#10;      &lt;/div&gt;&#10;&#10;      &lt;div className=&quot;max-w-7xl mx-auto px-4 py-12 space-y-10&quot;&gt;&#10;        &lt;div className=&quot;text-center mb-12&quot;&gt;&#10;          &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#d97757]/10 dark:bg-[#e89a7a]/10 border border-[#d97757]/20 dark:border-[#e89a7a]/20&quot;&gt;&#10;            &lt;Shield className=&quot;h-4 w-4 text-[#d97757] dark:text-[#e89a7a]&quot; /&gt;&#10;            &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#d97757] dark:text-[#e89a7a]&quot;&gt;&#10;              Nur für Admins&#10;            &lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold text-[#2a2520] dark:text-[#f5f1ed] mb-4&quot;&gt;&#10;            Benutzerverwaltung&#10;          &lt;/h1&gt;&#10;          &lt;p className=&quot;text-lg text-[#6b635a] dark:text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;            Alle Account-Werkzeuge an einem Ort – schön, klar, schnell.&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        {/* Quick stats */}&#10;        &lt;div className=&quot;grid gap-6 sm:grid-cols-2 lg:grid-cols-4&quot;&gt;&#10;          {[&#10;            {label:'Gesamt',value:stats.total,icon:&lt;Users className='h-5 w-5'/&gt;, color: &quot;from-[#d97757] to-[#c96846]&quot;},&#10;            {label:'Admins',value:stats.admins,icon:&lt;Shield className='h-5 w-5'/&gt;, color: &quot;from-[#c96846] to-[#b85836]&quot;},&#10;            {label:'Moderatoren',value:stats.moderators,icon:&lt;KeyRound className='h-5 w-5'/&gt;, color: &quot;from-[#7a9b88] to-[#6a8b78]&quot;},&#10;            {label:'Users',value:stats.users,icon:&lt;Users className='h-5 w-5'/&gt;, color: &quot;from-[#b8957a] to-[#a88568]&quot;}&#10;          ].map((s,i)=&gt; (&#10;            &lt;GlassCard key={s.label} delay={i*0.05}&gt;&#10;              &lt;div className=&quot;flex items-center gap-4&quot;&gt;&#10;                &lt;div className={`h-12 w-12 rounded-2xl bg-gradient-to-br ${s.color} flex items-center justify-center text-white shadow-lg`}&gt;&#10;                  {s.icon}&#10;                &lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;{s.label}&lt;/div&gt;&#10;                  &lt;div className=&quot;text-2xl font-bold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{s.value}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          ))}&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid lg:grid-cols-3 gap-8&quot;&gt;&#10;          {/* Left: Users list */}&#10;          &lt;div className=&quot;lg:col-span-2 space-y-8&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#10;                  &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                    &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 dark:bg-[#e89a7a]/10 text-[#d97757] dark:text-[#e89a7a]&quot;&gt;&#10;                      &lt;Users className=&quot;h-5 w-5&quot;/&gt;&#10;                    &lt;/span&gt;&#10;                    &lt;div&gt;&#10;                      &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Benutzer&lt;/h3&gt;&#10;                      &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Rollen, Passwörter und Login-Links verwalten.&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;a href=&quot;/admin&quot; className=&quot;text-sm text-[#d97757] dark:text-[#e89a7a] hover:underline inline-flex items-center gap-1&quot;&gt;&#10;                    &lt;ArrowLeft className=&quot;h-3 w-3&quot; /&gt;&#10;                    Zurück&#10;                  &lt;/a&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;form method=&quot;GET&quot; className=&quot;mb-6 flex flex-wrap items-center gap-3&quot;&gt;&#10;                &lt;input type=&quot;text&quot; name=&quot;q&quot; defaultValue={q} placeholder=&quot;Suche Username&quot; className=&quot;input-base flex-1 min-w-[200px]&quot; /&gt;&#10;                &lt;select name=&quot;class&quot; defaultValue={classFilter} className=&quot;input-base min-w-[160px]&quot;&gt;&#10;                  &lt;option value=&quot;&quot;&gt;Alle Klassen&lt;/option&gt;&#10;                  &lt;option value=&quot;none&quot;&gt;Ohne Klasse&lt;/option&gt;&#10;                  {CLASSES.map((c) =&gt; (&#10;                    &lt;option key={c} value={c}&gt;{c}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-5&quot;&gt;Filtern&lt;/GlowButton&gt;&#10;                &lt;a href=&quot;/admin/user&quot; className=&quot;text-sm text-[#d97757] dark:text-[#e89a7a] hover:underline&quot;&gt;Zurücksetzen&lt;/a&gt;&#10;              &lt;/form&gt;&#10;              &lt;div className=&quot;space-y-4&quot;&gt;&#10;                {users.map((u) =&gt; (&#10;                  &lt;div key={u.id} className=&quot;rounded-xl border border-[#d97757]/15 dark:border-[#e89a7a]/15 bg-white/60 dark:bg-[#2a2520]/60 p-4 hover:border-[#d97757]/25 dark:hover:border-[#e89a7a]/25 transition-all&quot;&gt;&#10;                    &lt;div className=&quot;flex items-center justify-between gap-4 mb-3&quot;&gt;&#10;                      &lt;div&gt;&#10;                        &lt;div className=&quot;text-sm flex items-center gap-2&quot;&gt;&#10;                          &lt;span className=&quot;font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;{u.username}&lt;/span&gt;&#10;                          &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#d97757]/10 dark:bg-[#e89a7a]/10 text-[#d97757] dark:text-[#e89a7a] border border-[#d97757]/20 dark:border-[#e89a7a]/20 text-xs font-medium&quot;&gt;&#10;                            {u.role}&#10;                          &lt;/span&gt;&#10;                          {u.class &amp;&amp; (&#10;                            &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#7a9b88]/10 dark:bg-[#8faf9d]/10 text-[#7a9b88] dark:text-[#8faf9d] border border-[#7a9b88]/20 dark:border-[#8faf9d]/20 text-xs font-medium&quot;&gt;&#10;                              {u.class}&#10;                            &lt;/span&gt;&#10;                          )}&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={deleteUserAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={u.id} /&gt;&#10;                        &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-3 py-2 text-sm&quot; iconLeft={&lt;Trash2 className=&quot;h-4 w-4&quot; /&gt;}&gt;Löschen&lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;flex flex-wrap items-center gap-3&quot;&gt;&#10;                      &lt;form action={updateUserRoleAction} className=&quot;flex items-center gap-2&quot;&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={u.id} /&gt;&#10;                        &lt;select name=&quot;role&quot; defaultValue={u.role} className=&quot;input-base text-sm&quot;&gt;&#10;                          &lt;option value=&quot;user&quot;&gt;user&lt;/option&gt;&#10;                          &lt;option value=&quot;moderator&quot;&gt;moderator&lt;/option&gt;&#10;                          &lt;option value=&quot;admin&quot;&gt;admin&lt;/option&gt;&#10;                        &lt;/select&gt;&#10;                        &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-3 py-2 text-sm&quot;&gt;Rolle&lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                      &lt;form action={updateUserPasswordAction} className=&quot;flex items-center gap-2 flex-1&quot;&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={u.id} /&gt;&#10;                        &lt;input name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;Neues Passwort&quot; className=&quot;input-base text-sm flex-1 min-w-[120px]&quot; /&gt;&#10;                        &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-3 py-2 text-sm&quot;&gt;Passwort&lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;mt-3 pt-3 border-t border-[#d97757]/10 dark:border-[#e89a7a]/10&quot;&gt;&#10;                      &lt;div className=&quot;inline-flex items-center gap-2 text-xs text-[#6b635a] dark:text-[#b8aea5] mb-2&quot;&gt;&#10;                        &lt;QrCode className=&quot;h-3.5 w-3.5 text-[#d97757] dark:text-[#e89a7a]&quot; /&gt;&#10;                        &lt;span&gt;Login-Link erstellen:&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;LoginLinkClient userId={u.id} username={u.username} /&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;&#10;          {/* Right: Create + Ban */}&#10;          &lt;div className=&quot;lg:col-span-1 space-y-6&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#7a9b88]/10 dark:bg-[#8faf9d]/10 text-[#7a9b88] dark:text-[#8faf9d]&quot;&gt;&#10;                    &lt;Users className=&quot;h-5 w-5&quot;/&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Nach Klassen&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[400px] overflow-y-auto&quot;&gt;&#10;                {groups.map((g) =&gt; (&#10;                  &lt;details key={g.label} className=&quot;rounded-xl border border-[#d97757]/10 dark:border-[#e89a7a]/10 bg-white/40 dark:bg-[#2a2520]/40 p-3 hover:border-[#d97757]/20 dark:hover:border-[#e89a7a]/20 transition-all&quot;&gt;&#10;                    &lt;summary className=&quot;cursor-pointer select-none text-sm text-[#2a2520] dark:text-[#f5f1ed] flex items-center justify-between font-medium&quot;&gt;&#10;                      &lt;span&gt;{g.label}&lt;/span&gt;&#10;                      &lt;span className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;{g.items.length}&lt;/span&gt;&#10;                    &lt;/summary&gt;&#10;                    {g.items.length === 0 ? (&#10;                      &lt;div className=&quot;mt-2 text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Keine Nutzer&lt;/div&gt;&#10;                    ) : (&#10;                      &lt;ul className=&quot;mt-3 space-y-2 text-sm&quot;&gt;&#10;                        {g.items.map((u) =&gt; (&#10;                          &lt;li key={u.id} className=&quot;flex items-center justify-between text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;&#10;                            &lt;span&gt;{u.username}&lt;/span&gt;&#10;                            &lt;span className=&quot;text-xs text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;{u.role}&lt;/span&gt;&#10;                          &lt;/li&gt;&#10;                        ))}&#10;                      &lt;/ul&gt;&#10;                    )}&#10;                  &lt;/details&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 dark:bg-[#e89a7a]/10 text-[#d97757] dark:text-[#e89a7a]&quot;&gt;&#10;                    &lt;UserPlus className=&quot;h-5 w-5&quot;/&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Benutzer anlegen&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;Schnell einen Zugang erstellen.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;form action={createUserAction} className=&quot;space-y-3&quot;&gt;&#10;                &lt;input name=&quot;username&quot; placeholder=&quot;Username&quot; className=&quot;input-base&quot; /&gt;&#10;                &lt;input name=&quot;password&quot; placeholder=&quot;Passwort&quot; type=&quot;password&quot; className=&quot;input-base&quot; /&gt;&#10;                &lt;select name=&quot;class&quot; defaultValue=&quot;&quot; className=&quot;input-base&quot;&gt;&#10;                  &lt;option value=&quot;&quot;&gt;Klasse (optional)&lt;/option&gt;&#10;                  {CLASSES.map((c) =&gt; (&#10;                    &lt;option key={c} value={c}&gt;{c}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;gradient&quot; className=&quot;w-full&quot; iconLeft={&lt;UserPlus className=&quot;h-4 w-4&quot; /&gt;}&gt;&#10;                  Benutzer erstellen&#10;                &lt;/GlowButton&gt;&#10;              &lt;/form&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#c96846]/10 dark:bg-[#d97757]/10 text-[#c96846] dark:text-[#d97757]&quot;&gt;&#10;                    &lt;Ban className=&quot;h-5 w-5&quot;/&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Sperren&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#6b635a] dark:text-[#b8aea5]&quot;&gt;User- und IP-Sperren verwalten.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-6&quot;&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm font-semibold mb-3 text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;Benutzer sperren&lt;/div&gt;&#10;                  &lt;form action={banUserAction} className=&quot;space-y-3&quot;&gt;&#10;                    &lt;input name=&quot;user_id&quot; placeholder=&quot;User ID&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;reason&quot; placeholder=&quot;Grund (optional)&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;expires_at&quot; type=&quot;datetime-local&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;primary&quot; className=&quot;w-full&quot;&gt;Sperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                  &lt;form action={unbanUserAction} className=&quot;flex items-center gap-2 mt-3&quot;&gt;&#10;                    &lt;input name=&quot;user_id&quot; placeholder=&quot;User ID&quot; className=&quot;input-base flex-1&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-4&quot;&gt;Entsperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;pt-3 border-t border-[#d97757]/10 dark:border-[#e89a7a]/10&quot;&gt;&#10;                  &lt;div className=&quot;text-sm font-semibold mb-3 text-[#2a2520] dark:text-[#f5f1ed]&quot;&gt;IP sperren&lt;/div&gt;&#10;                  &lt;form action={banIpAction} className=&quot;space-y-3&quot;&gt;&#10;                    &lt;input name=&quot;ip&quot; placeholder=&quot;IP-Adresse&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;reason&quot; placeholder=&quot;Grund (optional)&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;expires_at&quot; type=&quot;datetime-local&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;primary&quot; className=&quot;w-full&quot;&gt;Sperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                  &lt;form action={unbanIpAction} className=&quot;flex items-center gap-2 mt-3&quot;&gt;&#10;                    &lt;input name=&quot;ip&quot; placeholder=&quot;IP-Adresse&quot; className=&quot;input-base flex-1&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-4&quot;&gt;Entsperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="import { redirect } from &quot;next/navigation&quot;;&#10;import { getSession } from &quot;@/lib/session&quot;;&#10;import { query } from &quot;@/lib/db&quot;;&#10;import GlassCard from &quot;@/components/ui/GlassCard&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import LoginLinkClient from &quot;./LoginLinkClient&quot;;&#10;import { createUserAction, deleteUserAction, updateUserPasswordAction, updateUserRoleAction, banUserAction, unbanUserAction, banIpAction, unbanIpAction } from &quot;../actions&quot;;&#10;import { Users, Shield, KeyRound, UserPlus, Trash2, QrCode, Ban, ArrowLeft } from &quot;lucide-react&quot;;&#10;import { ensureUserClassColumn } from &quot;@/lib/migrations&quot;;&#10;import { CLASSES } from &quot;@/lib/constants&quot;;&#10;&#10;export const dynamic = &quot;force-dynamic&quot;;&#10;&#10;type UserRow = { id: number; username: string; role: &quot;user&quot; | &quot;moderator&quot; | &quot;admin&quot;; class: string | null };&#10;&#10;export default async function AdminUserPage({ searchParams }: { searchParams: Promise&lt;{ [key: string]: string | string[] | undefined }&gt; }) {&#10;  const session = await getSession();&#10;  if (!session) redirect(&quot;/login&quot;);&#10;  if (session.role !== &quot;admin&quot;) redirect(&quot;/zugriff-verweigert&quot;);&#10;&#10;  await ensureUserClassColumn();&#10;&#10;  const sp = await searchParams;&#10;  const q = typeof sp?.q === &quot;string&quot; ? sp.q.trim() : &quot;&quot;;&#10;  const classFilter = typeof sp?.class === &quot;string&quot; ? sp.class.trim() : &quot;&quot;;&#10;&#10;  const where: string[] = [];&#10;  const params: string[] = [];&#10;  if (q) { where.push(&quot;username LIKE ?&quot;); params.push(`%${q}%`); }&#10;  if (classFilter === &quot;none&quot;) { where.push(&quot;class IS NULL&quot;); }&#10;  else if (classFilter) { where.push(&quot;class = ?&quot;); params.push(classFilter); }&#10;  const whereSql = where.length ? `WHERE ${where.join(&quot; AND &quot;)}` : &quot;&quot;;&#10;&#10;  const users = await query&lt;UserRow[]&gt;(&#10;    `SELECT id, username, role, class FROM users ${whereSql} ORDER BY id DESC`,&#10;    params&#10;  );&#10;&#10;  const stats = {&#10;    total: users.length,&#10;    admins: users.filter((u) =&gt; u.role === 'admin').length,&#10;    moderators: users.filter((u) =&gt; u.role === 'moderator').length,&#10;    users: users.filter((u) =&gt; u.role === 'user').length,&#10;  };&#10;&#10;  const groups = [&#10;    { label: 'Ohne Klasse', items: users.filter((u) =&gt; !u.class) },&#10;    ...CLASSES.map((c) =&gt; ({ label: c, items: users.filter((u) =&gt; u.class === c) })),&#10;  ];&#10;&#10;  return (&#10;    &lt;div className=&quot;relative min-h-dvh overflow-hidden bg-gradient-to-br from-[#1a1714] via-[#221e1a] to-[#1a1714]&quot;&gt;&#10;      &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;        &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#e89a7a]/6 blur-3xl&quot; /&gt;&#10;        &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#8faf9d]/6 blur-3xl&quot; /&gt;&#10;      &lt;/div&gt;&#10;&#10;      &lt;div className=&quot;max-w-7xl mx-auto px-4 py-12 space-y-10&quot;&gt;&#10;        &lt;div className=&quot;text-center mb-12&quot;&gt;&#10;          &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#e89a7a]/10 border border-[#e89a7a]/20&quot;&gt;&#10;            &lt;Shield className=&quot;h-4 w-4 text-[#e89a7a]&quot; /&gt;&#10;            &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#e89a7a]&quot;&gt;&#10;              Nur für Admins&#10;            &lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold text-[#f5f1ed] mb-4&quot;&gt;&#10;            Benutzerverwaltung&#10;          &lt;/h1&gt;&#10;          &lt;p className=&quot;text-lg text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;            Alle Account-Werkzeuge an einem Ort – schön, klar, schnell.&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        {/* Quick stats */}&#10;        &lt;div className=&quot;grid gap-6 sm:grid-cols-2 lg:grid-cols-4&quot;&gt;&#10;          {[&#10;            {label:'Gesamt',value:stats.total,icon:&lt;Users className='h-5 w-5'/&gt;, color: &quot;from-[#d97757] to-[#c96846]&quot;},&#10;            {label:'Admins',value:stats.admins,icon:&lt;Shield className='h-5 w-5'/&gt;, color: &quot;from-[#c96846] to-[#b85836]&quot;},&#10;            {label:'Moderatoren',value:stats.moderators,icon:&lt;KeyRound className='h-5 w-5'/&gt;, color: &quot;from-[#7a9b88] to-[#6a8b78]&quot;},&#10;            {label:'Users',value:stats.users,icon:&lt;Users className='h-5 w-5'/&gt;, color: &quot;from-[#b8957a] to-[#a88568]&quot;}&#10;          ].map((s,i)=&gt; (&#10;            &lt;GlassCard key={s.label} delay={i*0.05}&gt;&#10;              &lt;div className=&quot;flex items-center gap-4&quot;&gt;&#10;                &lt;div className={`h-12 w-12 rounded-2xl bg-gradient-to-br ${s.color} flex items-center justify-center text-white shadow-lg`}&gt;&#10;                  {s.icon}&#10;                &lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#b8aea5]&quot;&gt;{s.label}&lt;/div&gt;&#10;                  &lt;div className=&quot;text-2xl font-bold text-[#f5f1ed]&quot;&gt;{s.value}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          ))}&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid lg:grid-cols-3 gap-8&quot;&gt;&#10;          {/* Left: Users list */}&#10;          &lt;div className=&quot;lg:col-span-2 space-y-8&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center justify-between&quot;&gt;&#10;                  &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                    &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                      &lt;Users className=&quot;h-5 w-5&quot;/&gt;&#10;                    &lt;/span&gt;&#10;                    &lt;div&gt;&#10;                      &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Benutzer&lt;/h3&gt;&#10;                      &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Rollen, Passwörter und Login-Links verwalten.&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;a href=&quot;/admin&quot; className=&quot;text-sm text-[#e89a7a] hover:underline inline-flex items-center gap-1&quot;&gt;&#10;                    &lt;ArrowLeft className=&quot;h-3 w-3&quot; /&gt;&#10;                    Zurück&#10;                  &lt;/a&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;form method=&quot;GET&quot; className=&quot;mb-6 flex flex-wrap items-center gap-3&quot;&gt;&#10;                &lt;input type=&quot;text&quot; name=&quot;q&quot; defaultValue={q} placeholder=&quot;Suche Username&quot; className=&quot;input-base flex-1 min-w-[200px]&quot; /&gt;&#10;                &lt;select name=&quot;class&quot; defaultValue={classFilter} className=&quot;input-base min-w-[160px]&quot;&gt;&#10;                  &lt;option value=&quot;&quot;&gt;Alle Klassen&lt;/option&gt;&#10;                  &lt;option value=&quot;none&quot;&gt;Ohne Klasse&lt;/option&gt;&#10;                  {CLASSES.map((c) =&gt; (&#10;                    &lt;option key={c} value={c}&gt;{c}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-5&quot;&gt;Filtern&lt;/GlowButton&gt;&#10;                &lt;a href=&quot;/admin/user&quot; className=&quot;text-sm text-[#e89a7a] hover:underline&quot;&gt;Zurücksetzen&lt;/a&gt;&#10;              &lt;/form&gt;&#10;              &lt;div className=&quot;space-y-4&quot;&gt;&#10;                {users.map((u) =&gt; (&#10;                  &lt;div key={u.id} className=&quot;rounded-xl border border-[#e89a7a]/15 bg-[#2a2520]/60 p-4 hover:border-[#e89a7a]/25 transition-all&quot;&gt;&#10;                    &lt;div className=&quot;flex items-center justify-between gap-4 mb-3&quot;&gt;&#10;                      &lt;div&gt;&#10;                        &lt;div className=&quot;text-sm flex items-center gap-2&quot;&gt;&#10;                          &lt;span className=&quot;font-semibold text-[#f5f1ed]&quot;&gt;{u.username}&lt;/span&gt;&#10;                          &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#e89a7a]/10 text-[#e89a7a] border border-[#e89a7a]/20 text-xs font-medium&quot;&gt;&#10;                            {u.role}&#10;                          &lt;/span&gt;&#10;                          {u.class &amp;&amp; (&#10;                            &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#8faf9d]/10 text-[#8faf9d] border border-[#8faf9d]/20 text-xs font-medium&quot;&gt;&#10;                              {u.class}&#10;                            &lt;/span&gt;&#10;                          )}&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={deleteUserAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={u.id} /&gt;&#10;                        &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-3 py-2 text-sm&quot; iconLeft={&lt;Trash2 className=&quot;h-4 w-4&quot; /&gt;}&gt;Löschen&lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;flex flex-wrap items-center gap-3&quot;&gt;&#10;                      &lt;form action={updateUserRoleAction} className=&quot;flex items-center gap-2&quot;&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={u.id} /&gt;&#10;                        &lt;select name=&quot;role&quot; defaultValue={u.role} className=&quot;input-base text-sm&quot;&gt;&#10;                          &lt;option value=&quot;user&quot;&gt;user&lt;/option&gt;&#10;                          &lt;option value=&quot;moderator&quot;&gt;moderator&lt;/option&gt;&#10;                          &lt;option value=&quot;admin&quot;&gt;admin&lt;/option&gt;&#10;                        &lt;/select&gt;&#10;                        &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-3 py-2 text-sm&quot;&gt;Rolle&lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                      &lt;form action={updateUserPasswordAction} className=&quot;flex items-center gap-2 flex-1&quot;&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={u.id} /&gt;&#10;                        &lt;input name=&quot;password&quot; type=&quot;password&quot; placeholder=&quot;Neues Passwort&quot; className=&quot;input-base text-sm flex-1 min-w-[120px]&quot; /&gt;&#10;                        &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-3 py-2 text-sm&quot;&gt;Passwort&lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;&#10;                    &lt;div className=&quot;mt-3 pt-3 border-t border-[#e89a7a]/10&quot;&gt;&#10;                      &lt;div className=&quot;inline-flex items-center gap-2 text-xs text-[#b8aea5] mb-2&quot;&gt;&#10;                        &lt;QrCode className=&quot;h-3.5 w-3.5 text-[#e89a7a]&quot; /&gt;&#10;                        &lt;span&gt;Login-Link erstellen:&lt;/span&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;LoginLinkClient userId={u.id} username={u.username} /&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;&#10;          {/* Right: Create + Ban */}&#10;          &lt;div className=&quot;lg:col-span-1 space-y-6&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#8faf9d]/10 text-[#8faf9d]&quot;&gt;&#10;                    &lt;Users className=&quot;h-5 w-5&quot;/&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Nach Klassen&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[400px] overflow-y-auto&quot;&gt;&#10;                {groups.map((g) =&gt; (&#10;                  &lt;details key={g.label} className=&quot;rounded-xl border border-[#e89a7a]/10 bg-[#2a2520]/40 p-3 hover:border-[#e89a7a]/20 transition-all&quot;&gt;&#10;                    &lt;summary className=&quot;cursor-pointer select-none text-sm text-[#f5f1ed] flex items-center justify-between font-medium&quot;&gt;&#10;                      &lt;span&gt;{g.label}&lt;/span&gt;&#10;                      &lt;span className=&quot;text-xs text-[#b8aea5]&quot;&gt;{g.items.length}&lt;/span&gt;&#10;                    &lt;/summary&gt;&#10;                    {g.items.length === 0 ? (&#10;                      &lt;div className=&quot;mt-2 text-xs text-[#b8aea5]&quot;&gt;Keine Nutzer&lt;/div&gt;&#10;                    ) : (&#10;                      &lt;ul className=&quot;mt-3 space-y-2 text-sm&quot;&gt;&#10;                        {g.items.map((u) =&gt; (&#10;                          &lt;li key={u.id} className=&quot;flex items-center justify-between text-[#f5f1ed]&quot;&gt;&#10;                            &lt;span&gt;{u.username}&lt;/span&gt;&#10;                            &lt;span className=&quot;text-xs text-[#b8aea5]&quot;&gt;{u.role}&lt;/span&gt;&#10;                          &lt;/li&gt;&#10;                        ))}&#10;                      &lt;/ul&gt;&#10;                    )}&#10;                  &lt;/details&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                    &lt;UserPlus className=&quot;h-5 w-5&quot;/&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Benutzer anlegen&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Schnell einen Zugang erstellen.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;form action={createUserAction} className=&quot;space-y-3&quot;&gt;&#10;                &lt;input name=&quot;username&quot; placeholder=&quot;Username&quot; className=&quot;input-base&quot; /&gt;&#10;                &lt;input name=&quot;password&quot; placeholder=&quot;Passwort&quot; type=&quot;password&quot; className=&quot;input-base&quot; /&gt;&#10;                &lt;select name=&quot;class&quot; defaultValue=&quot;&quot; className=&quot;input-base&quot;&gt;&#10;                  &lt;option value=&quot;&quot;&gt;Klasse (optional)&lt;/option&gt;&#10;                  {CLASSES.map((c) =&gt; (&#10;                    &lt;option key={c} value={c}&gt;{c}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;gradient&quot; className=&quot;w-full&quot; iconLeft={&lt;UserPlus className=&quot;h-4 w-4&quot; /&gt;}&gt;&#10;                  Benutzer erstellen&#10;                &lt;/GlowButton&gt;&#10;              &lt;/form&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 text-[#d97757]&quot;&gt;&#10;                    &lt;Ban className=&quot;h-5 w-5&quot;/&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Sperren&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;User- und IP-Sperren verwalten.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-6&quot;&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm font-semibold mb-3 text-[#f5f1ed]&quot;&gt;Benutzer sperren&lt;/div&gt;&#10;                  &lt;form action={banUserAction} className=&quot;space-y-3&quot;&gt;&#10;                    &lt;input name=&quot;user_id&quot; placeholder=&quot;User ID&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;reason&quot; placeholder=&quot;Grund (optional)&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;expires_at&quot; type=&quot;datetime-local&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;primary&quot; className=&quot;w-full&quot;&gt;Sperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                  &lt;form action={unbanUserAction} className=&quot;flex items-center gap-2 mt-3&quot;&gt;&#10;                    &lt;input name=&quot;user_id&quot; placeholder=&quot;User ID&quot; className=&quot;input-base flex-1&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-4&quot;&gt;Entsperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;pt-3 border-t border-[#e89a7a]/10&quot;&gt;&#10;                  &lt;div className=&quot;text-sm font-semibold mb-3 text-[#f5f1ed]&quot;&gt;IP sperren&lt;/div&gt;&#10;                  &lt;form action={banIpAction} className=&quot;space-y-3&quot;&gt;&#10;                    &lt;input name=&quot;ip&quot; placeholder=&quot;IP-Adresse&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;reason&quot; placeholder=&quot;Grund (optional)&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;input name=&quot;expires_at&quot; type=&quot;datetime-local&quot; className=&quot;input-base&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;primary&quot; className=&quot;w-full&quot;&gt;Sperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                  &lt;form action={unbanIpAction} className=&quot;flex items-center gap-2 mt-3&quot;&gt;&#10;                    &lt;input name=&quot;ip&quot; placeholder=&quot;IP-Adresse&quot; className=&quot;input-base flex-1&quot; /&gt;&#10;                    &lt;GlowButton variant=&quot;secondary&quot; className=&quot;px-4&quot;&gt;Entsperren&lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>