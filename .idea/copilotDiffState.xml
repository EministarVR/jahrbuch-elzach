<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/admin/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/admin/page.tsx" />
              <option name="originalContent" value="import { redirect } from &quot;next/navigation&quot;;&#10;import { getSession } from &quot;@/lib/session&quot;;&#10;import { query } from &quot;@/lib/db&quot;;&#10;import { ensureModerationSchema, ensurePhaseSettings } from &quot;@/lib/migrations&quot;;&#10;import { getPhaseSettings } from &quot;@/lib/phases&quot;;&#10;import GlassCard from &quot;@/components/ui/GlassCard&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import ProfileAvatar from &quot;@/components/ProfileAvatar&quot;;&#10;import {&#10;  approveSubmissionAction,&#10;  deleteSubmissionAction,&#10;  restoreSubmissionAction,&#10;  approveManySubmissionsAction,&#10;  deleteManySubmissionsAction,&#10;  togglePhaseAction,&#10;} from &quot;./actions&quot;;&#10;import ReportsList from &quot;./ReportsList&quot;;&#10;import {&#10;  CheckCircle2,&#10;  XCircle,&#10;  RotateCcw,&#10;  User2,&#10;  FileText,&#10;  Users,&#10;  Trash2,&#10;  Clock,&#10;  Shield,&#10;  Activity,&#10;  Layers,&#10;  ToggleLeft,&#10;  Wrench,&#10;  Flag,&#10;} from &quot;lucide-react&quot;;&#10;&#10;export const dynamic = &quot;force-dynamic&quot;;&#10;&#10;type SubmissionRow = {&#10;  id: number;&#10;  user_id: number;&#10;  text: string;&#10;  category: string;&#10;  name: string | null;&#10;  phone: string | null;&#10;  created_at: string;&#10;  status: &quot;pending&quot; | &quot;approved&quot; | &quot;deleted&quot;;&#10;  approved_by: number | null;&#10;  approved_at: string | null;&#10;  deleted_by: number | null;&#10;  deleted_at: string | null;&#10;  author: string;&#10;  approver: string | null;&#10;  deleter: string | null;&#10;};&#10;&#10;type AuditRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  action: &quot;create&quot; | &quot;approve&quot; | &quot;delete&quot; | &quot;restore&quot;;&#10;  actor_user_id: number;&#10;  created_at: string;&#10;  actor: string;&#10;  preview: string;&#10;};&#10;&#10;type ReportRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  reporter_user_id: number;&#10;  reason: string;&#10;  status: 'pending' | 'reviewed' | 'dismissed';&#10;  created_at: string;&#10;  reporter: string;&#10;  submission_text: string;&#10;  submission_author: string;&#10;};&#10;&#10;export default async function AdminPage({ searchParams }: { searchParams: Promise&lt;{ [_key: string]: string | string[] | undefined }&gt; }) {&#10;  const session = await getSession();&#10;  if (!session) redirect(&quot;/login&quot;);&#10;  if (session.role !== &quot;moderator&quot; &amp;&amp; session.role !== &quot;admin&quot;) redirect(&quot;/zugriff-verweigert&quot;);&#10;  const isAdmin = session.role === &quot;admin&quot;;&#10;&#10;  // Ensure schema is ready (adds status columns + audit table if missing)&#10;  await ensureModerationSchema();&#10;  await ensurePhaseSettings();&#10;&#10;  const [stats] = (await query&lt;&#10;    { pending: number; approved: number; deleted: number; total: number }[]&#10;  &gt;(&#10;    &quot;SELECT SUM(status='pending') AS pending, SUM(status='approved') AS approved, SUM(status='deleted') AS deleted, COUNT(*) AS total FROM submissions&quot;&#10;  )) || [{ pending: 0, approved: 0, deleted: 0, total: 0 }];&#10;&#10;  const sp = await searchParams;&#10;  const q = typeof sp?.q === &quot;string&quot; ? sp.q.trim() : &quot;&quot;;&#10;  const category = typeof sp?.category === &quot;string&quot; ? sp.category.trim() : &quot;&quot;;&#10;  const wherePendingParts: string[] = [&quot;s.status = 'pending'&quot;];&#10;  const pendingParams: string[] = [];&#10;  if (category) { wherePendingParts.push(&quot;s.category = ?&quot;); pendingParams.push(category); }&#10;  if (q) {&#10;    wherePendingParts.push(&quot;(s.text LIKE ? OR au.username LIKE ? OR COALESCE(s.name,'') LIKE ? OR COALESCE(s.phone,'') LIKE ?)&quot;);&#10;    const like = `%${q}%`;&#10;    pendingParams.push(like, like, like, like);&#10;  }&#10;  const pending = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE ${wherePendingParts.join(&quot; AND &quot;)}&#10;     ORDER BY s.created_at DESC`,&#10;    pendingParams&#10;  );&#10;&#10;  const approved = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'approved'&#10;     ORDER BY s.approved_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const deleted = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'deleted'&#10;     ORDER BY s.deleted_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const audit = await query&lt;AuditRow[]&gt;(&#10;    `SELECT a.*, u.username AS actor, LEFT(s.text, 80) AS preview&#10;     FROM submission_audit a&#10;     JOIN users u ON u.id = a.actor_user_id&#10;     JOIN submissions s ON s.id = a.submission_id&#10;     ORDER BY a.created_at DESC&#10;     LIMIT 60`&#10;  );&#10;&#10;  const reports = await query&lt;ReportRow[]&gt;(&#10;    `SELECT r.*, &#10;            u.username AS reporter,&#10;            LEFT(s.text, 100) AS submission_text,&#10;            au.username AS submission_author&#10;     FROM submission_reports r&#10;     JOIN users u ON u.id = r.reporter_user_id&#10;     JOIN submissions s ON s.id = r.submission_id&#10;     JOIN users au ON au.id = s.user_id&#10;     WHERE r.status = 'pending'&#10;     ORDER BY r.created_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const categories = await query&lt;{ category: string }[]&gt;(&#10;    &quot;SELECT DISTINCT category FROM submissions ORDER BY category&quot;&#10;  );&#10;&#10;  const phaseSettings = await getPhaseSettings();&#10;&#10;  return (&#10;    &lt;div className=&quot;relative min-h-dvh overflow-hidden bg-gradient-to-br from-[#1a1714] via-[#221e1a] to-[#1a1714]&quot;&gt;&#10;      {/* Subtile Hintergrundeffekte */}&#10;      &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;        &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#e89a7a]/6 blur-3xl&quot; /&gt;&#10;        &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#8faf9d]/6 blur-3xl&quot; /&gt;&#10;      &lt;/div&gt;&#10;&#10;      &lt;div className=&quot;max-w-6xl mx-auto px-4 py-12 space-y-10&quot;&gt;&#10;        &lt;div className=&quot;text-center mb-12&quot;&gt;&#10;          &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#8faf9d]/10 border border-[#8faf9d]/20&quot;&gt;&#10;            &lt;Shield className=&quot;h-4 w-4 text-[#8faf9d]&quot; /&gt;&#10;            &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#8faf9d]&quot;&gt;&#10;              Admin-Bereich&#10;            &lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold text-[#f5f1ed] mb-4&quot;&gt;&#10;            Dashboard&#10;          &lt;/h1&gt;&#10;          &lt;p className=&quot;text-lg text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;            Moderiere Einsendungen, verwalte Accounts und behalte den Überblick.&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        {/* Statistiken */}&#10;        &lt;div className=&quot;grid gap-6 md:grid-cols-4&quot;&gt;&#10;          {[&#10;            { label: &quot;Gesamt&quot;, value: stats?.total || 0, icon: &lt;Users className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#d97757] to-[#c96846]&quot; },&#10;            { label: &quot;Ausstehend&quot;, value: stats?.pending || 0, icon: &lt;Clock className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#b8957a] to-[#a88568]&quot; },&#10;            { label: &quot;Genehmigt&quot;, value: stats?.approved || 0, icon: &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#7a9b88] to-[#6a8b78]&quot; },&#10;            { label: &quot;Gelöscht&quot;, value: stats?.deleted || 0, icon: &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#c96846] to-[#b85836]&quot; },&#10;          ].map((s, i) =&gt; (&#10;            &lt;GlassCard key={s.label} delay={i * 0.06}&gt;&#10;              &lt;div className=&quot;flex items-center gap-4&quot;&gt;&#10;                &lt;div className={`h-12 w-12 rounded-2xl bg-gradient-to-br ${s.color} flex items-center justify-center text-white shadow-lg`}&gt;&#10;                  {s.icon}&#10;                &lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#b8aea5]&quot;&gt;{s.label}&lt;/div&gt;&#10;                  &lt;div className=&quot;text-2xl font-bold text-[#f5f1ed]&quot;&gt;{s.value}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          ))}&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid lg:grid-cols-3 gap-8&quot;&gt;&#10;          {/* Moderationsliste */}&#10;          &lt;div className=&quot;lg:col-span-2 space-y-8&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                    &lt;FileText className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Ausstehende Einsendungen&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Prüfen, genehmigen oder löschen.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {/* Filter */}&#10;              &lt;form method=&quot;GET&quot; className=&quot;mb-6 flex flex-wrap items-center gap-3&quot;&gt;&#10;                &lt;input&#10;                  type=&quot;text&quot;&#10;                  name=&quot;q&quot;&#10;                  defaultValue={q}&#10;                  placeholder=&quot;Suche Text/Autor/Name&quot;&#10;                  className=&quot;input-base flex-1 min-w-[200px]&quot;&#10;                /&gt;&#10;                &lt;select&#10;                  name=&quot;category&quot;&#10;                  defaultValue={category}&#10;                  className=&quot;input-base min-w-[160px]&quot;&#10;                &gt;&#10;                  &lt;option value=&quot;&quot;&gt;Alle Kategorien&lt;/option&gt;&#10;                  {categories.map((c) =&gt; (&#10;                    &lt;option key={c.category} value={c.category}&gt;{c.category}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-5&quot;&gt;Filtern&lt;/GlowButton&gt;&#10;                &lt;a href=&quot;/admin&quot; className=&quot;text-sm text-[#e89a7a] hover:underline&quot;&gt;Zurücksetzen&lt;/a&gt;&#10;              &lt;/form&gt;&#10;&#10;              {pending.length === 0 ? (&#10;                &lt;div className=&quot;text-center py-12&quot;&gt;&#10;                  &lt;div className=&quot;inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-[#8faf9d]/10 text-[#8faf9d] mb-4&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-8 w-8&quot; /&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Keine ausstehenden Einsendungen. Alles erledigt! ✨&lt;/p&gt;&#10;                &lt;/div&gt;&#10;              ) : (&#10;                &lt;div&gt;&#10;                  &lt;form id=&quot;bulk-form-pending&quot; className=&quot;mb-4 flex items-center justify-end gap-3&quot;&gt;&#10;                    &lt;GlowButton&#10;                      formAction={approveManySubmissionsAction}&#10;                      variant=&quot;primary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl genehmigen&#10;                    &lt;/GlowButton&gt;&#10;                    &lt;GlowButton&#10;                      formAction={deleteManySubmissionsAction}&#10;                      variant=&quot;secondary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl löschen&#10;                    &lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                  &lt;div className=&quot;space-y-4&quot;&gt;&#10;                    {pending.map((p) =&gt; (&#10;                      &lt;div key={p.id} className=&quot;rounded-2xl border border-[#e89a7a]/15 bg-[#2a2520]/80 p-5 hover:border-[#e89a7a]/25 transition-all&quot;&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                          &lt;div className=&quot;flex items-start gap-4 flex-1&quot;&gt;&#10;                            &lt;input&#10;                              type=&quot;checkbox&quot;&#10;                              name=&quot;ids&quot;&#10;                              value={p.id}&#10;                              form=&quot;bulk-form-pending&quot;&#10;                              className=&quot;mt-1.5 h-5 w-5 rounded border-[#e89a7a]/30 text-[#e89a7a] focus:ring-[#d97757]/50&quot;&#10;                            /&gt;&#10;                            &lt;div className=&quot;flex-1&quot;&gt;&#10;                              &lt;div className=&quot;text-xs text-[#b8aea5] flex flex-wrap items-center gap-2 mb-3&quot;&gt;&#10;                                &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&#10;                                  &lt;ProfileAvatar userId={p.user_id} username={p.author} size={18} /&gt;&#10;                                  &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt;{p.author}&lt;/strong&gt;&#10;                                &lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span&gt;{new Date(p.created_at).toLocaleString(&quot;de-DE&quot;)}&lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#e89a7a]/10 text-[#e89a7a] text-xs font-medium border border-[#e89a7a]/20&quot;&gt;&#10;                                  {p.category}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                              &lt;div className=&quot;text-sm text-[#f5f1ed] leading-relaxed whitespace-pre-wrap&quot;&gt;&#10;                                {p.text}&#10;                              &lt;/div&gt;&#10;                              {(p.name || p.phone) &amp;&amp; (&#10;                                &lt;div className=&quot;mt-3 pt-3 border-t border-[#e89a7a]/10 text-xs text-[#b8aea5]&quot;&gt;&#10;                                  {[p.name, p.phone].filter(Boolean).join(&quot; · &quot;)}&#10;                                &lt;/div&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;shrink-0 flex flex-col gap-2&quot;&gt;&#10;                            &lt;form action={approveSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;primary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Genehmigen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                            &lt;form action={deleteSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;secondary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Löschen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    ))}&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#8faf9d]/10 text-[#8faf9d]&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Genehmigt (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {approved.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Noch nichts genehmigt.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {approved.map((a) =&gt; (&#10;                    &lt;div key={a.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#8faf9d]/15 bg-[#8faf9d]/5 p-4 hover:border-[#8faf9d]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&lt;ProfileAvatar userId={a.user_id} username={a.author} size={16} /&gt; &lt;strong&gt;{a.author}&lt;/strong&gt;&lt;/span&gt; • {a.category} • genehmigt von &lt;strong&gt;{a.approver || &quot;—&quot;}&lt;/strong&gt; am {a.approved_at ? new Date(a.approved_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap&quot;&gt;{a.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={deleteSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={a.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;secondary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;Trash2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Löschen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 text-[#d97757]&quot;&gt;&#10;                    &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Gelöscht (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {deleted.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Keine gelöschten Beiträge.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {deleted.map((d) =&gt; (&#10;                    &lt;div key={d.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#d97757]/15 bg-[#d97757]/5 p-4 hover:border-[#d97757]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&lt;ProfileAvatar userId={d.user_id} username={d.author} size={16} /&gt; &lt;strong&gt;{d.author}&lt;/strong&gt;&lt;/span&gt; • {d.category} • gelöscht von &lt;strong&gt;{d.deleter || &quot;—&quot;}&lt;/strong&gt; am {d.deleted_at ? new Date(d.deleted_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap opacity-75&quot;&gt;{d.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={restoreSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={d.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;primary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;RotateCcw className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Wiederherstellen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-red-400/10 text-red-400&quot;&gt;&#10;                    &lt;Flag className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Gemeldete Beiträge&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;User-Meldungen prüfen und bearbeiten.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;ReportsList reports={reports} /&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;&#10;          {/* Sidebar */}&#10;          &lt;div className=&quot;lg:col-span-1 space-y-6&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#8faf9d]/10 text-[#8faf9d]&quot;&gt;&#10;                    &lt;Shield className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Schnellzugriff&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3&quot;&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Zur Startseite&#10;                &lt;/GlowButton&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/phase-1&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Beitrag einreichen&#10;                &lt;/GlowButton&gt;&#10;                {isAdmin &amp;&amp; (&#10;                  &lt;GlowButton&#10;                    as=&quot;a&quot;&#10;                    href=&quot;/admin/user&quot;&#10;                    variant=&quot;primary&quot;&#10;                    className=&quot;w-full justify-start&quot;&#10;                    iconLeft={&lt;Users className=&quot;h-4 w-4&quot; /&gt;}&#10;                  &gt;&#10;                    Benutzerverwaltung&#10;                  &lt;/GlowButton&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                    &lt;Activity className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Aktivitätsprotokoll&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[500px] overflow-y-auto&quot;&gt;&#10;                {audit.slice(0, 20).map((log) =&gt; (&#10;                  &lt;div key={log.id} className=&quot;text-xs&quot;&gt;&#10;                    &lt;div className=&quot;flex items-center gap-2 text-[#b8aea5]&quot;&gt;&#10;                      &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                        log.action === 'create' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'approve' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'delete' ? 'bg-[#c96846]' :&#10;                        'bg-[#d97757]'&#10;                      }`} /&gt;&#10;                      &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt;{log.actor}&lt;/strong&gt;&#10;                      &lt;span&gt;•&lt;/span&gt;&#10;                      &lt;span&gt;{log.action === 'create' ? 'erstellt' : log.action === 'approve' ? 'genehmigt' : log.action === 'delete' ? 'gelöscht' : 'wiederhergestellt'}&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;mt-1 text-[#b8aea5] line-clamp-2 pl-4&quot;&gt;&#10;                      {log.preview}...&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;text-[#b8aea7] opacity-60 pl-4 mt-0.5&quot;&gt;&#10;                      {new Date(log.created_at).toLocaleString(&quot;de-DE&quot;)}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            {/* Phase Control Panel (only for admins) */}&#10;            {isAdmin &amp;&amp; (&#10;              &lt;GlassCard&#10;                header={&#10;                  &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                    &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#66bb6a]/10 text-[#66bb6a]&quot;&gt;&#10;                      &lt;Layers className=&quot;h-5 w-5&quot; /&gt;&#10;                    &lt;/span&gt;&#10;                    &lt;div&gt;&#10;                      &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Phasensteuerung&lt;/h3&gt;&#10;                      &lt;p className=&quot;text-xs text-[#b8aea5]&quot;&gt;Aktiviere/Deaktiviere Phasen für User&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                }&#10;              &gt;&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {phaseSettings.map((phase) =&gt; {&#10;                    const isDevelopment = phase.status === 'development';&#10;&#10;                    return (&#10;                      &lt;div key={phase.id} className={`rounded-xl border ${&#10;                        phase.enabled &#10;                          ? 'border-[#66bb6a]/20 bg-[#66bb6a]/5' &#10;                          : isDevelopment&#10;                          ? 'border-[#ffb74d]/20 bg-[#ffb74d]/5'&#10;                          : 'border-[#b8aea5]/20 bg-[#b8aea5]/5'&#10;                      } p-4 transition-all`}&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-3 mb-3&quot;&gt;&#10;                          &lt;div className=&quot;flex-1&quot;&gt;&#10;                            &lt;div className=&quot;flex items-center gap-2 mb-1&quot;&gt;&#10;                              &lt;div className=&quot;text-sm font-semibold text-[#f5f1ed]&quot;&gt;&#10;                                {phase.title}&#10;                              &lt;/div&gt;&#10;                              {isDevelopment &amp;&amp; (&#10;                                &lt;span className=&quot;inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[#ffb74d]/10 text-[#ffb74d] text-xs font-medium border border-[#ffb74d]/20&quot;&gt;&#10;                                  &lt;Wrench className=&quot;h-3 w-3&quot; /&gt;&#10;                                  In Entwicklung&#10;                                &lt;/span&gt;&#10;                              )}&#10;                              {!isDevelopment &amp;&amp; (&#10;                                &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                                  phase.enabled ? 'bg-[#4caf50] animate-pulse' : 'bg-[#f44336]'&#10;                                }`} /&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                            &lt;p className=&quot;text-xs text-[#b8aea5]&quot;&gt;&#10;                              {phase.description}&#10;                            &lt;/p&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        {isDevelopment ? (&#10;                          &lt;div className=&quot;rounded-lg bg-[#ffb74d]/10 border border-[#ffb74d]/20 px-4 py-3 text-center&quot;&gt;&#10;                            &lt;span className=&quot;text-xs font-medium text-[#ffb74d]&quot;&gt;&#10;                              Diese Phase ist noch nicht fertig und kann nicht aktiviert werden&#10;                            &lt;/span&gt;&#10;                          &lt;/div&gt;&#10;                        ) : (&#10;                          &lt;form action={togglePhaseAction}&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;phaseKey&quot; value={phase.phase_key} /&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;enabled&quot; value={phase.enabled ? 'false' : 'true'} /&gt;&#10;                            &lt;GlowButton&#10;                              variant={phase.enabled ? &quot;secondary&quot; : &quot;primary&quot;}&#10;                              className=&quot;w-full text-sm&quot;&#10;                              iconLeft={phase.enabled ? &lt;ToggleLeft className=&quot;h-4 w-4&quot; /&gt; : &lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                            &gt;&#10;                              {phase.enabled ? 'Deaktivieren' : 'Aktivieren'}&#10;                            &lt;/GlowButton&gt;&#10;                          &lt;/form&gt;&#10;                        )}&#10;                      &lt;/div&gt;&#10;                    );&#10;                  })}&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;mt-4 p-3 rounded-xl bg-[#64b5f6]/5 border border-[#64b5f6]/20&quot;&gt;&#10;                  &lt;div className=&quot;text-xs text-[#b8aea5]&quot;&gt;&#10;                    &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt; Info:&lt;/strong&gt; Admins können deaktivierte Phasen trotzdem betreten (Testzwecke).&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/GlassCard&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
              <option name="updatedContent" value="import { redirect } from &quot;next/navigation&quot;;&#10;import { getSession } from &quot;@/lib/session&quot;;&#10;import { query } from &quot;@/lib/db&quot;;&#10;import { ensureModerationSchema, ensurePhaseSettings, ensureSubmissionMediaColumns } from &quot;@/lib/migrations&quot;;&#10;import { getPhaseSettings } from &quot;@/lib/phases&quot;;&#10;import GlassCard from &quot;@/components/ui/GlassCard&quot;;&#10;import GlowButton from &quot;@/components/ui/GlowButton&quot;;&#10;import ProfileAvatar from &quot;@/components/ProfileAvatar&quot;;&#10;import {&#10;  approveSubmissionAction,&#10;  deleteSubmissionAction,&#10;  restoreSubmissionAction,&#10;  approveManySubmissionsAction,&#10;  deleteManySubmissionsAction,&#10;  togglePhaseAction,&#10;} from &quot;./actions&quot;;&#10;import ReportsList from &quot;./ReportsList&quot;;&#10;import {&#10;  CheckCircle2,&#10;  XCircle,&#10;  RotateCcw,&#10;  User2,&#10;  FileText,&#10;  Users,&#10;  Trash2,&#10;  Clock,&#10;  Shield,&#10;  Activity,&#10;  Layers,&#10;  ToggleLeft,&#10;  Wrench,&#10;  Flag,&#10;} from &quot;lucide-react&quot;;&#10;&#10;export const dynamic = &quot;force-dynamic&quot;;&#10;&#10;type SubmissionRow = {&#10;  id: number;&#10;  user_id: number;&#10;  text: string;&#10;  category: string;&#10;  name: string | null;&#10;  phone: string | null;&#10;  created_at: string;&#10;  status: &quot;pending&quot; | &quot;approved&quot; | &quot;deleted&quot;;&#10;  approved_by: number | null;&#10;  approved_at: string | null;&#10;  deleted_by: number | null;&#10;  deleted_at: string | null;&#10;  author: string;&#10;  approver: string | null;&#10;  deleter: string | null;&#10;};&#10;&#10;type AuditRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  action: &quot;create&quot; | &quot;approve&quot; | &quot;delete&quot; | &quot;restore&quot;;&#10;  actor_user_id: number;&#10;  created_at: string;&#10;  actor: string;&#10;  preview: string;&#10;};&#10;&#10;type ReportRow = {&#10;  id: number;&#10;  submission_id: number;&#10;  reporter_user_id: number;&#10;  reason: string;&#10;  status: 'pending' | 'reviewed' | 'dismissed';&#10;  created_at: string;&#10;  reporter: string;&#10;  submission_text: string;&#10;  submission_author: string;&#10;};&#10;&#10;export default async function AdminPage({ searchParams }: { searchParams: Promise&lt;{ [_key: string]: string | string[] | undefined }&gt; }) {&#10;  const session = await getSession();&#10;  if (!session) redirect(&quot;/login&quot;);&#10;  if (session.role !== &quot;moderator&quot; &amp;&amp; session.role !== &quot;admin&quot;) redirect(&quot;/zugriff-verweigert&quot;);&#10;  const isAdmin = session.role === &quot;admin&quot;;&#10;&#10;  // Ensure schema is ready (adds status columns + audit table if missing)&#10;  await ensureModerationSchema();&#10;  await ensurePhaseSettings();&#10;  await ensureSubmissionMediaColumns();&#10;&#10;  const [stats] = (await query&lt;&#10;    { pending: number; approved: number; deleted: number; total: number }[]&#10;  &gt;(&#10;    &quot;SELECT SUM(status='pending') AS pending, SUM(status='approved') AS approved, SUM(status='deleted') AS deleted, COUNT(*) AS total FROM submissions&quot;&#10;  )) || [{ pending: 0, approved: 0, deleted: 0, total: 0 }];&#10;&#10;  const sp = await searchParams;&#10;  const q = typeof sp?.q === &quot;string&quot; ? sp.q.trim() : &quot;&quot;;&#10;  const category = typeof sp?.category === &quot;string&quot; ? sp.category.trim() : &quot;&quot;;&#10;  const wherePendingParts: string[] = [&quot;s.status = 'pending'&quot;];&#10;  const pendingParams: string[] = [];&#10;  if (category) { wherePendingParts.push(&quot;s.category = ?&quot;); pendingParams.push(category); }&#10;  if (q) {&#10;    wherePendingParts.push(&quot;(s.text LIKE ? OR au.username LIKE ? OR COALESCE(s.name,'') LIKE ? OR COALESCE(s.phone,'') LIKE ?)&quot;);&#10;    const like = `%${q}%`;&#10;    pendingParams.push(like, like, like, like);&#10;  }&#10;  const pending = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE ${wherePendingParts.join(&quot; AND &quot;)}&#10;     ORDER BY s.created_at DESC`,&#10;    pendingParams&#10;  );&#10;&#10;  const approved = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'approved'&#10;     ORDER BY s.approved_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const deleted = await query&lt;SubmissionRow[]&gt;(&#10;    `SELECT s.*, au.username AS author,&#10;            ap.username AS approver, de.username AS deleter&#10;     FROM submissions s&#10;     JOIN users au ON au.id = s.user_id&#10;     LEFT JOIN users ap ON ap.id = s.approved_by&#10;     LEFT JOIN users de ON de.id = s.deleted_by&#10;     WHERE s.status = 'deleted'&#10;     ORDER BY s.deleted_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const audit = await query&lt;AuditRow[]&gt;(&#10;    `SELECT a.*, u.username AS actor, LEFT(s.text, 80) AS preview&#10;     FROM submission_audit a&#10;     JOIN users u ON u.id = a.actor_user_id&#10;     JOIN submissions s ON s.id = a.submission_id&#10;     ORDER BY a.created_at DESC&#10;     LIMIT 60`&#10;  );&#10;&#10;  const reports = await query&lt;ReportRow[]&gt;(&#10;    `SELECT r.*, &#10;            u.username AS reporter,&#10;            LEFT(s.text, 100) AS submission_text,&#10;            au.username AS submission_author&#10;     FROM submission_reports r&#10;     JOIN users u ON u.id = r.reporter_user_id&#10;     JOIN submissions s ON s.id = r.submission_id&#10;     JOIN users au ON au.id = s.user_id&#10;     WHERE r.status = 'pending'&#10;     ORDER BY r.created_at DESC&#10;     LIMIT 50`&#10;  );&#10;&#10;  const categories = await query&lt;{ category: string }[]&gt;(&#10;    &quot;SELECT DISTINCT category FROM submissions ORDER BY category&quot;&#10;  );&#10;&#10;  const phaseSettings = await getPhaseSettings();&#10;&#10;  return (&#10;    &lt;div className=&quot;relative min-h-dvh overflow-hidden bg-gradient-to-br from-[#1a1714] via-[#221e1a] to-[#1a1714]&quot;&gt;&#10;      {/* Subtile Hintergrundeffekte */}&#10;      &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;        &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#e89a7a]/6 blur-3xl&quot; /&gt;&#10;        &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#8faf9d]/6 blur-3xl&quot; /&gt;&#10;      &lt;/div&gt;&#10;&#10;      &lt;div className=&quot;max-w-6xl mx-auto px-4 py-12 space-y-10&quot;&gt;&#10;        &lt;div className=&quot;text-center mb-12&quot;&gt;&#10;          &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#8faf9d]/10 border border-[#8faf9d]/20&quot;&gt;&#10;            &lt;Shield className=&quot;h-4 w-4 text-[#8faf9d]&quot; /&gt;&#10;            &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#8faf9d]&quot;&gt;&#10;              Admin-Bereich&#10;            &lt;/span&gt;&#10;          &lt;/div&gt;&#10;          &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold text-[#f5f1ed] mb-4&quot;&gt;&#10;            Dashboard&#10;          &lt;/h1&gt;&#10;          &lt;p className=&quot;text-lg text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;            Moderiere Einsendungen, verwalte Accounts und behalte den Überblick.&#10;          &lt;/p&gt;&#10;        &lt;/div&gt;&#10;&#10;        {/* Statistiken */}&#10;        &lt;div className=&quot;grid gap-6 md:grid-cols-4&quot;&gt;&#10;          {[&#10;            { label: &quot;Gesamt&quot;, value: stats?.total || 0, icon: &lt;Users className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#d97757] to-[#c96846]&quot; },&#10;            { label: &quot;Ausstehend&quot;, value: stats?.pending || 0, icon: &lt;Clock className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#b8957a] to-[#a88568]&quot; },&#10;            { label: &quot;Genehmigt&quot;, value: stats?.approved || 0, icon: &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#7a9b88] to-[#6a8b78]&quot; },&#10;            { label: &quot;Gelöscht&quot;, value: stats?.deleted || 0, icon: &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;, color: &quot;from-[#c96846] to-[#b85836]&quot; },&#10;          ].map((s, i) =&gt; (&#10;            &lt;GlassCard key={s.label} delay={i * 0.06}&gt;&#10;              &lt;div className=&quot;flex items-center gap-4&quot;&gt;&#10;                &lt;div className={`h-12 w-12 rounded-2xl bg-gradient-to-br ${s.color} flex items-center justify-center text-white shadow-lg`}&gt;&#10;                  {s.icon}&#10;                &lt;/div&gt;&#10;                &lt;div&gt;&#10;                  &lt;div className=&quot;text-sm text-[#b8aea5]&quot;&gt;{s.label}&lt;/div&gt;&#10;                  &lt;div className=&quot;text-2xl font-bold text-[#f5f1ed]&quot;&gt;{s.value}&lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;          ))}&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;grid lg:grid-cols-3 gap-8&quot;&gt;&#10;          {/* Moderationsliste */}&#10;          &lt;div className=&quot;lg:col-span-2 space-y-8&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                    &lt;FileText className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Ausstehende Einsendungen&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Prüfen, genehmigen oder löschen.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {/* Filter */}&#10;              &lt;form method=&quot;GET&quot; className=&quot;mb-6 flex flex-wrap items-center gap-3&quot;&gt;&#10;                &lt;input&#10;                  type=&quot;text&quot;&#10;                  name=&quot;q&quot;&#10;                  defaultValue={q}&#10;                  placeholder=&quot;Suche Text/Autor/Name&quot;&#10;                  className=&quot;input-base flex-1 min-w-[200px]&quot;&#10;                /&gt;&#10;                &lt;select&#10;                  name=&quot;category&quot;&#10;                  defaultValue={category}&#10;                  className=&quot;input-base min-w-[160px]&quot;&#10;                &gt;&#10;                  &lt;option value=&quot;&quot;&gt;Alle Kategorien&lt;/option&gt;&#10;                  {categories.map((c) =&gt; (&#10;                    &lt;option key={c.category} value={c.category}&gt;{c.category}&lt;/option&gt;&#10;                  ))}&#10;                &lt;/select&gt;&#10;                &lt;GlowButton variant=&quot;primary&quot; className=&quot;px-5&quot;&gt;Filtern&lt;/GlowButton&gt;&#10;                &lt;a href=&quot;/admin&quot; className=&quot;text-sm text-[#e89a7a] hover:underline&quot;&gt;Zurücksetzen&lt;/a&gt;&#10;              &lt;/form&gt;&#10;&#10;              {pending.length === 0 ? (&#10;                &lt;div className=&quot;text-center py-12&quot;&gt;&#10;                  &lt;div className=&quot;inline-flex h-16 w-16 items-center justify-center rounded-2xl bg-[#8faf9d]/10 text-[#8faf9d] mb-4&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-8 w-8&quot; /&gt;&#10;                  &lt;/div&gt;&#10;                  &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Keine ausstehenden Einsendungen. Alles erledigt! ✨&lt;/p&gt;&#10;                &lt;/div&gt;&#10;              ) : (&#10;                &lt;div&gt;&#10;                  &lt;form id=&quot;bulk-form-pending&quot; className=&quot;mb-4 flex items-center justify-end gap-3&quot;&gt;&#10;                    &lt;GlowButton&#10;                      formAction={approveManySubmissionsAction}&#10;                      variant=&quot;primary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl genehmigen&#10;                    &lt;/GlowButton&gt;&#10;                    &lt;GlowButton&#10;                      formAction={deleteManySubmissionsAction}&#10;                      variant=&quot;secondary&quot;&#10;                      className=&quot;px-4 py-2 text-sm&quot;&#10;                      iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                    &gt;&#10;                      Auswahl löschen&#10;                    &lt;/GlowButton&gt;&#10;                  &lt;/form&gt;&#10;                  &lt;div className=&quot;space-y-4&quot;&gt;&#10;                    {pending.map((p) =&gt; (&#10;                      &lt;div key={p.id} className=&quot;rounded-2xl border border-[#e89a7a]/15 bg-[#2a2520]/80 p-5 hover:border-[#e89a7a]/25 transition-all&quot;&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-4&quot;&gt;&#10;                          &lt;div className=&quot;flex items-start gap-4 flex-1&quot;&gt;&#10;                            &lt;input&#10;                              type=&quot;checkbox&quot;&#10;                              name=&quot;ids&quot;&#10;                              value={p.id}&#10;                              form=&quot;bulk-form-pending&quot;&#10;                              className=&quot;mt-1.5 h-5 w-5 rounded border-[#e89a7a]/30 text-[#e89a7a] focus:ring-[#d97757]/50&quot;&#10;                            /&gt;&#10;                            &lt;div className=&quot;flex-1&quot;&gt;&#10;                              &lt;div className=&quot;text-xs text-[#b8aea5] flex flex-wrap items-center gap-2 mb-3&quot;&gt;&#10;                                &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&#10;                                  &lt;ProfileAvatar userId={p.user_id} username={p.author} size={18} /&gt;&#10;                                  &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt;{p.author}&lt;/strong&gt;&#10;                                &lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span&gt;{new Date(p.created_at).toLocaleString(&quot;de-DE&quot;)}&lt;/span&gt;&#10;                                &lt;span&gt;•&lt;/span&gt;&#10;                                &lt;span className=&quot;inline-flex items-center px-2.5 py-1 rounded-full bg-[#e89a7a]/10 text-[#e89a7a] text-xs font-medium border border-[#e89a7a]/20&quot;&gt;&#10;                                  {p.category}&#10;                                &lt;/span&gt;&#10;                              &lt;/div&gt;&#10;                              &lt;div className=&quot;text-sm text-[#f5f1ed] leading-relaxed whitespace-pre-wrap&quot;&gt;&#10;                                {p.text}&#10;                              &lt;/div&gt;&#10;                              {(p.name || p.phone) &amp;&amp; (&#10;                                &lt;div className=&quot;mt-3 pt-3 border-t border-[#e89a7a]/10 text-xs text-[#b8aea5]&quot;&gt;&#10;                                  {[p.name, p.phone].filter(Boolean).join(&quot; · &quot;)}&#10;                                &lt;/div&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                          &lt;/div&gt;&#10;                          &lt;div className=&quot;shrink-0 flex flex-col gap-2&quot;&gt;&#10;                            &lt;form action={approveSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;primary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Genehmigen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                            &lt;form action={deleteSubmissionAction}&gt;&#10;                              &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={p.id} /&gt;&#10;                              &lt;GlowButton&#10;                                variant=&quot;secondary&quot;&#10;                                className=&quot;px-4 py-2 text-sm whitespace-nowrap w-full&quot;&#10;                                iconLeft={&lt;XCircle className=&quot;h-4 w-4&quot; /&gt;}&#10;                              &gt;&#10;                                Löschen&#10;                              &lt;/GlowButton&gt;&#10;                            &lt;/form&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                    ))}&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#8faf9d]/10 text-[#8faf9d]&quot;&gt;&#10;                    &lt;CheckCircle2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Genehmigt (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {approved.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Noch nichts genehmigt.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {approved.map((a) =&gt; (&#10;                    &lt;div key={a.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#8faf9d]/15 bg-[#8faf9d]/5 p-4 hover:border-[#8faf9d]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&lt;ProfileAvatar userId={a.user_id} username={a.author} size={16} /&gt; &lt;strong&gt;{a.author}&lt;/strong&gt;&lt;/span&gt; • {a.category} • genehmigt von &lt;strong&gt;{a.approver || &quot;—&quot;}&lt;/strong&gt; am {a.approved_at ? new Date(a.approved_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap&quot;&gt;{a.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={deleteSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={a.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;secondary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;Trash2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Löschen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#d97757]/10 text-[#d97757]&quot;&gt;&#10;                    &lt;Trash2 className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Gelöscht (zuletzt 50)&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              {deleted.length === 0 ? (&#10;                &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;Keine gelöschten Beiträge.&lt;/p&gt;&#10;              ) : (&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {deleted.map((d) =&gt; (&#10;                    &lt;div key={d.id} className=&quot;flex items-start justify-between gap-4 rounded-xl border border-[#d97757]/15 bg-[#d97757]/5 p-4 hover:border-[#d97757]/25 transition-all&quot;&gt;&#10;                      &lt;div className=&quot;flex-1&quot;&gt;&#10;                        &lt;div className=&quot;text-xs text-[#b8aea5] mb-2&quot;&gt;&#10;                          Von &lt;span className=&quot;inline-flex items-center gap-1.5&quot;&gt;&lt;ProfileAvatar userId={d.user_id} username={d.author} size={16} /&gt; &lt;strong&gt;{d.author}&lt;/strong&gt;&lt;/span&gt; • {d.category} • gelöscht von &lt;strong&gt;{d.deleter || &quot;—&quot;}&lt;/strong&gt; am {d.deleted_at ? new Date(d.deleted_at).toLocaleString(&quot;de-DE&quot;) : &quot;—&quot;}&#10;                        &lt;/div&gt;&#10;                        &lt;div className=&quot;text-sm text-[#f5f1ed] line-clamp-3 whitespace-pre-wrap opacity-75&quot;&gt;{d.text}&lt;/div&gt;&#10;                      &lt;/div&gt;&#10;                      &lt;form action={restoreSubmissionAction}&gt;&#10;                        &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value={d.id} /&gt;&#10;                        &lt;GlowButton&#10;                          variant=&quot;primary&quot;&#10;                          className=&quot;px-3 py-2 text-sm&quot;&#10;                          iconLeft={&lt;RotateCcw className=&quot;h-4 w-4&quot; /&gt;}&#10;                        &gt;&#10;                          Wiederherstellen&#10;                        &lt;/GlowButton&gt;&#10;                      &lt;/form&gt;&#10;                    &lt;/div&gt;&#10;                  ))}&#10;                &lt;/div&gt;&#10;              )}&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-red-400/10 text-red-400&quot;&gt;&#10;                    &lt;Flag className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;div&gt;&#10;                    &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Gemeldete Beiträge&lt;/h3&gt;&#10;                    &lt;p className=&quot;text-sm text-[#b8aea5]&quot;&gt;User-Meldungen prüfen und bearbeiten.&lt;/p&gt;&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;ReportsList reports={reports} /&gt;&#10;            &lt;/GlassCard&gt;&#10;          &lt;/div&gt;&#10;&#10;          {/* Sidebar */}&#10;          &lt;div className=&quot;lg:col-span-1 space-y-6&quot;&gt;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#8faf9d]/10 text-[#8faf9d]&quot;&gt;&#10;                    &lt;Shield className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Schnellzugriff&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3&quot;&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Zur Startseite&#10;                &lt;/GlowButton&gt;&#10;                &lt;GlowButton&#10;                  as=&quot;a&quot;&#10;                  href=&quot;/phase-1&quot;&#10;                  variant=&quot;secondary&quot;&#10;                  className=&quot;w-full justify-start&quot;&#10;                &gt;&#10;                  Beitrag einreichen&#10;                &lt;/GlowButton&gt;&#10;                {isAdmin &amp;&amp; (&#10;                  &lt;GlowButton&#10;                    as=&quot;a&quot;&#10;                    href=&quot;/admin/user&quot;&#10;                    variant=&quot;primary&quot;&#10;                    className=&quot;w-full justify-start&quot;&#10;                    iconLeft={&lt;Users className=&quot;h-4 w-4&quot; /&gt;}&#10;                  &gt;&#10;                    Benutzerverwaltung&#10;                  &lt;/GlowButton&gt;&#10;                )}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            &lt;GlassCard&#10;              header={&#10;                &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                  &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#e89a7a]/10 text-[#e89a7a]&quot;&gt;&#10;                    &lt;Activity className=&quot;h-5 w-5&quot; /&gt;&#10;                  &lt;/span&gt;&#10;                  &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Aktivitätsprotokoll&lt;/h3&gt;&#10;                &lt;/div&gt;&#10;              }&#10;            &gt;&#10;              &lt;div className=&quot;space-y-3 max-h-[500px] overflow-y-auto&quot;&gt;&#10;                {audit.slice(0, 20).map((log) =&gt; (&#10;                  &lt;div key={log.id} className=&quot;text-xs&quot;&gt;&#10;                    &lt;div className=&quot;flex items-center gap-2 text-[#b8aea5]&quot;&gt;&#10;                      &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                        log.action === 'create' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'approve' ? 'bg-[#7a9b88]' :&#10;                        log.action === 'delete' ? 'bg-[#c96846]' :&#10;                        'bg-[#d97757]'&#10;                      }`} /&gt;&#10;                      &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt;{log.actor}&lt;/strong&gt;&#10;                      &lt;span&gt;•&lt;/span&gt;&#10;                      &lt;span&gt;{log.action === 'create' ? 'erstellt' : log.action === 'approve' ? 'genehmigt' : log.action === 'delete' ? 'gelöscht' : 'wiederhergestellt'}&lt;/span&gt;&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;mt-1 text-[#b8aea5] line-clamp-2 pl-4&quot;&gt;&#10;                      {log.preview}...&#10;                    &lt;/div&gt;&#10;                    &lt;div className=&quot;text-[#b8aea7] opacity-60 pl-4 mt-0.5&quot;&gt;&#10;                      {new Date(log.created_at).toLocaleString(&quot;de-DE&quot;)}&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                ))}&#10;              &lt;/div&gt;&#10;            &lt;/GlassCard&gt;&#10;&#10;            {/* Phase Control Panel (only for admins) */}&#10;            {isAdmin &amp;&amp; (&#10;              &lt;GlassCard&#10;                header={&#10;                  &lt;div className=&quot;flex items-center gap-3&quot;&gt;&#10;                    &lt;span className=&quot;inline-flex h-10 w-10 items-center justify-center rounded-xl bg-[#66bb6a]/10 text-[#66bb6a]&quot;&gt;&#10;                      &lt;Layers className=&quot;h-5 w-5&quot; /&gt;&#10;                    &lt;/span&gt;&#10;                    &lt;div&gt;&#10;                      &lt;h3 className=&quot;text-lg font-semibold text-[#f5f1ed]&quot;&gt;Phasensteuerung&lt;/h3&gt;&#10;                      &lt;p className=&quot;text-xs text-[#b8aea5]&quot;&gt;Aktiviere/Deaktiviere Phasen für User&lt;/p&gt;&#10;                    &lt;/div&gt;&#10;                  &lt;/div&gt;&#10;                }&#10;              &gt;&#10;                &lt;div className=&quot;space-y-3&quot;&gt;&#10;                  {phaseSettings.map((phase) =&gt; {&#10;                    const isDevelopment = phase.status === 'development';&#10;&#10;                    return (&#10;                      &lt;div key={phase.id} className={`rounded-xl border ${&#10;                        phase.enabled &#10;                          ? 'border-[#66bb6a]/20 bg-[#66bb6a]/5' &#10;                          : isDevelopment&#10;                          ? 'border-[#ffb74d]/20 bg-[#ffb74d]/5'&#10;                          : 'border-[#b8aea5]/20 bg-[#b8aea5]/5'&#10;                      } p-4 transition-all`}&gt;&#10;                        &lt;div className=&quot;flex items-start justify-between gap-3 mb-3&quot;&gt;&#10;                          &lt;div className=&quot;flex-1&quot;&gt;&#10;                            &lt;div className=&quot;flex items-center gap-2 mb-1&quot;&gt;&#10;                              &lt;div className=&quot;text-sm font-semibold text-[#f5f1ed]&quot;&gt;&#10;                                {phase.title}&#10;                              &lt;/div&gt;&#10;                              {isDevelopment &amp;&amp; (&#10;                                &lt;span className=&quot;inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-[#ffb74d]/10 text-[#ffb74d] text-xs font-medium border border-[#ffb74d]/20&quot;&gt;&#10;                                  &lt;Wrench className=&quot;h-3 w-3&quot; /&gt;&#10;                                  In Entwicklung&#10;                                &lt;/span&gt;&#10;                              )}&#10;                              {!isDevelopment &amp;&amp; (&#10;                                &lt;span className={`inline-flex h-2 w-2 rounded-full ${&#10;                                  phase.enabled ? 'bg-[#4caf50] animate-pulse' : 'bg-[#f44336]'&#10;                                }`} /&gt;&#10;                              )}&#10;                            &lt;/div&gt;&#10;                            &lt;p className=&quot;text-xs text-[#b8aea5]&quot;&gt;&#10;                              {phase.description}&#10;                            &lt;/p&gt;&#10;                          &lt;/div&gt;&#10;                        &lt;/div&gt;&#10;&#10;                        {isDevelopment ? (&#10;                          &lt;div className=&quot;rounded-lg bg-[#ffb74d]/10 border border-[#ffb74d]/20 px-4 py-3 text-center&quot;&gt;&#10;                            &lt;span className=&quot;text-xs font-medium text-[#ffb74d]&quot;&gt;&#10;                              Diese Phase ist noch nicht fertig und kann nicht aktiviert werden&#10;                            &lt;/span&gt;&#10;                          &lt;/div&gt;&#10;                        ) : (&#10;                          &lt;form action={togglePhaseAction}&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;phaseKey&quot; value={phase.phase_key} /&gt;&#10;                            &lt;input type=&quot;hidden&quot; name=&quot;enabled&quot; value={phase.enabled ? 'false' : 'true'} /&gt;&#10;                            &lt;GlowButton&#10;                              variant={phase.enabled ? &quot;secondary&quot; : &quot;primary&quot;}&#10;                              className=&quot;w-full text-sm&quot;&#10;                              iconLeft={phase.enabled ? &lt;ToggleLeft className=&quot;h-4 w-4&quot; /&gt; : &lt;CheckCircle2 className=&quot;h-4 w-4&quot; /&gt;}&#10;                            &gt;&#10;                              {phase.enabled ? 'Deaktivieren' : 'Aktivieren'}&#10;                            &lt;/GlowButton&gt;&#10;                          &lt;/form&gt;&#10;                        )}&#10;                      &lt;/div&gt;&#10;                    );&#10;                  })}&#10;                &lt;/div&gt;&#10;                &lt;div className=&quot;mt-4 p-3 rounded-xl bg-[#64b5f6]/5 border border-[#64b5f6]/20&quot;&gt;&#10;                  &lt;div className=&quot;text-xs text-[#b8aea5]&quot;&gt;&#10;                    &lt;strong className=&quot;text-[#f5f1ed]&quot;&gt; Info:&lt;/strong&gt; Admins können deaktivierte Phasen trotzdem betreten (Testzwecke).&#10;                  &lt;/div&gt;&#10;                &lt;/div&gt;&#10;              &lt;/GlassCard&gt;&#10;            )}&#10;          &lt;/div&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    &lt;/div&gt;&#10;  );&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/browse/page.tsx">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/browse/page.tsx" />
              <option name="originalContent" value="import { redirect } from 'next/navigation';&#10;import { getSession } from '@/lib/session';&#10;import { getDbPool } from '@/lib/db';&#10;import { ensureModerationSchema, ensureCommentsSchema } from '@/lib/migrations';&#10;import { CATEGORIES } from '@/lib/constants';&#10;import BrowseClient from './BrowseClient';&#10;import type { RowDataPacket } from 'mysql2';&#10;import { BookOpen } from 'lucide-react';&#10;&#10;export const dynamic = 'force-dynamic';&#10;&#10;export interface Submission extends RowDataPacket {&#10;  id: number;&#10;  user_id: number;&#10;  text: string;&#10;  category: string;&#10;  name: string | null;&#10;  phone: string | null;&#10;  media_url: string | null;&#10;  media_type: 'image' | 'video' | 'gif' | null;&#10;  media_mime: string | null;&#10;  media_width: number | null;&#10;  media_height: number | null;&#10;  media_duration_ms: number | null;&#10;  media_thumb_url: string | null;&#10;  created_at: string;&#10;  upvotes: number;&#10;  downvotes: number;&#10;  user_vote: 'upvote' | 'downvote' | null;&#10;  author: string;&#10;  author_class: string | null;&#10;}&#10;&#10;export default async function BrowsePage({&#10;  searchParams,&#10;}: {&#10;  searchParams?: Promise&lt;{ sort?: string; category?: string }&gt;;&#10;}) {&#10;  const session = await getSession();&#10;  if (!session) redirect('/login');&#10;&#10;  await ensureModerationSchema();&#10;  await ensureCommentsSchema();&#10;&#10;  const sp = searchParams ? await searchParams : undefined;&#10;  const sortBy = sp?.sort || 'recent';&#10;  const filterCategory = sp?.category || 'all';&#10;&#10;  const conn = await getDbPool().getConnection();&#10;  try {&#10;    // Submissions mit Vote-Counts abrufen&#10;    let query = `&#10;      SELECT &#10;        s.id,&#10;        s.user_id,&#10;        s.text,&#10;        s.category,&#10;        s.name,&#10;        s.phone,&#10;        s.media_url,&#10;        s.media_type,&#10;        s.media_mime,&#10;        s.media_width,&#10;        s.media_height,&#10;        s.media_duration_ms,&#10;        s.media_thumb_url,&#10;        s.created_at,&#10;        s.status,&#10;        u.username AS author,&#10;        u.class AS author_class,&#10;        COALESCE(SUM(CASE WHEN sv.vote_type = 'upvote' THEN 1 ELSE 0 END), 0) AS upvotes,&#10;        COALESCE(SUM(CASE WHEN sv.vote_type = 'downvote' THEN 1 ELSE 0 END), 0) AS downvotes,&#10;        uv.vote_type AS user_vote&#10;      FROM submissions s&#10;      JOIN users u ON u.id = s.user_id&#10;      LEFT JOIN submission_votes sv ON s.id = sv.submission_id&#10;      LEFT JOIN submission_votes uv ON s.id = uv.submission_id AND uv.user_id = ?&#10;      WHERE s.status IN ('approved', 'pending')&#10;    `;&#10;&#10;    const params: (number | string)[] = [session.userId];&#10;&#10;    if (filterCategory !== 'all') {&#10;      query += ' AND s.category = ?';&#10;      params.push(filterCategory);&#10;    }&#10;&#10;    query += ' GROUP BY s.id, s.user_id, s.text, s.category, s.name, s.phone, s.media_url, s.media_type, s.media_mime, s.media_width, s.media_height, s.media_duration_ms, s.media_thumb_url, s.created_at, s.status, u.username, u.class, uv.vote_type';&#10;&#10;    // Sortierung&#10;    switch (sortBy) {&#10;      case 'upvotes':&#10;        query += ' ORDER BY upvotes DESC, s.created_at DESC';&#10;        break;&#10;      case 'downvotes':&#10;        query += ' ORDER BY downvotes DESC, s.created_at DESC';&#10;        break;&#10;      case 'controversial':&#10;        query += ' ORDER BY (upvotes + downvotes) DESC, ABS(upvotes - downvotes) ASC, s.created_at DESC';&#10;        break;&#10;      case 'oldest':&#10;        query += ' ORDER BY s.created_at ASC';&#10;        break;&#10;      case 'recent':&#10;      default:&#10;        query += ' ORDER BY s.created_at DESC';&#10;        break;&#10;    }&#10;&#10;    const [submissions] = await conn.execute&lt;Submission[]&gt;(query, params);&#10;&#10;    const isModerator = session.role === 'moderator' || session.role === 'admin';&#10;&#10;    return (&#10;      &lt;div className=&quot;relative min-h-dvh bg-gradient-to-br from-[#1a1714] via-[#221e1a] to-[#1a1714] overflow-hidden&quot;&gt;&#10;        {/* Subtile Hintergrundeffekte */}&#10;        &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;          &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#e89a7a]/6 blur-3xl animate-pulse&quot; /&gt;&#10;          &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#8faf9d]/6 blur-3xl animate-pulse&quot; style={{ animationDelay: '1s' }} /&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;max-w-6xl mx-auto px-4 py-12&quot;&gt;&#10;          &lt;div className=&quot;text-center mb-12 animate-in fade-in slide-in-from-bottom-4 duration-700&quot;&gt;&#10;            &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#8faf9d]/10 border border-[#8faf9d]/20 shadow-lg shadow-[#8faf9d]/10&quot;&gt;&#10;              &lt;BookOpen className=&quot;h-4 w-4 text-[#8faf9d]&quot; /&gt;&#10;              &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#8faf9d]&quot;&gt;&#10;                Community&#10;              &lt;/span&gt;&#10;            &lt;/div&gt;&#10;            &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-br from-[#f5f1ed] to-[#b8aea5] bg-clip-text text-transparent&quot;&gt;&#10;              Alle Beiträge&#10;            &lt;/h1&gt;&#10;            &lt;p className=&quot;text-lg text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;              Entdecke die Beiträge der Schüler, vote für deine Favoriten und teile deine Meinung.&#10;            &lt;/p&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;BrowseClient&#10;            initialSubmissions={submissions}&#10;            isModerator={isModerator}&#10;            currentUserId={session.userId}&#10;            currentSort={sortBy}&#10;            currentCategory={filterCategory}&#10;            categories={['all', ...CATEGORIES]}&#10;          /&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    );&#10;  } finally {&#10;    conn.release();&#10;  }&#10;}&#10;" />
              <option name="updatedContent" value="import { redirect } from 'next/navigation';&#10;import { getSession } from '@/lib/session';&#10;import { getDbPool } from '@/lib/db';&#10;import { ensureModerationSchema, ensureCommentsSchema } from '@/lib/migrations';&#10;import { CATEGORIES } from '@/lib/constants';&#10;import BrowseClient from './BrowseClient';&#10;import type { RowDataPacket } from 'mysql2';&#10;import { BookOpen } from 'lucide-react';&#10;&#10;export const dynamic = 'force-dynamic';&#10;&#10;export interface Submission extends RowDataPacket {&#10;  id: number;&#10;  user_id: number;&#10;  text: string;&#10;  category: string;&#10;  name: string | null;&#10;  phone: string | null;&#10;  media_url: string | null;&#10;  media_type: 'image' | 'video' | 'gif' | null;&#10;  media_mime: string | null;&#10;  media_width: number | null;&#10;  media_height: number | null;&#10;  media_duration_ms: number | null;&#10;  media_thumb_url: string | null;&#10;  created_at: string;&#10;  upvotes: number;&#10;  downvotes: number;&#10;  user_vote: 'upvote' | 'downvote' | null;&#10;  author: string;&#10;  author_class: string | null;&#10;}&#10;&#10;export default async function BrowsePage({&#10;  searchParams,&#10;}: {&#10;  searchParams?: Promise&lt;{ sort?: string; category?: string }&gt;;&#10;}) {&#10;  const session = await getSession();&#10;  if (!session) redirect('/login');&#10;&#10;  await ensureModerationSchema();&#10;  await ensureCommentsSchema();&#10;  await ensureSubmissionMediaColumns();&#10;&#10;  const sp = searchParams ? await searchParams : undefined;&#10;  const sortBy = sp?.sort || 'recent';&#10;  const filterCategory = sp?.category || 'all';&#10;&#10;  const conn = await getDbPool().getConnection();&#10;  try {&#10;    // Submissions mit Vote-Counts abrufen&#10;    let query = `&#10;      SELECT &#10;        s.id,&#10;        s.user_id,&#10;        s.text,&#10;        s.category,&#10;        s.name,&#10;        s.phone,&#10;        s.media_url,&#10;        s.media_type,&#10;        s.media_mime,&#10;        s.media_width,&#10;        s.media_height,&#10;        s.media_duration_ms,&#10;        s.media_thumb_url,&#10;        s.created_at,&#10;        s.status,&#10;        u.username AS author,&#10;        u.class AS author_class,&#10;        COALESCE(SUM(CASE WHEN sv.vote_type = 'upvote' THEN 1 ELSE 0 END), 0) AS upvotes,&#10;        COALESCE(SUM(CASE WHEN sv.vote_type = 'downvote' THEN 1 ELSE 0 END), 0) AS downvotes,&#10;        uv.vote_type AS user_vote&#10;      FROM submissions s&#10;      JOIN users u ON u.id = s.user_id&#10;      LEFT JOIN submission_votes sv ON s.id = sv.submission_id&#10;      LEFT JOIN submission_votes uv ON s.id = uv.submission_id AND uv.user_id = ?&#10;      WHERE s.status IN ('approved', 'pending')&#10;    `;&#10;&#10;    const params: (number | string)[] = [session.userId];&#10;&#10;    if (filterCategory !== 'all') {&#10;      query += ' AND s.category = ?';&#10;      params.push(filterCategory);&#10;    }&#10;&#10;    query += ' GROUP BY s.id, s.user_id, s.text, s.category, s.name, s.phone, s.media_url, s.media_type, s.media_mime, s.media_width, s.media_height, s.media_duration_ms, s.media_thumb_url, s.created_at, s.status, u.username, u.class, uv.vote_type';&#10;&#10;    // Sortierung&#10;    switch (sortBy) {&#10;      case 'upvotes':&#10;        query += ' ORDER BY upvotes DESC, s.created_at DESC';&#10;        break;&#10;      case 'downvotes':&#10;        query += ' ORDER BY downvotes DESC, s.created_at DESC';&#10;        break;&#10;      case 'controversial':&#10;        query += ' ORDER BY (upvotes + downvotes) DESC, ABS(upvotes - downvotes) ASC, s.created_at DESC';&#10;        break;&#10;      case 'oldest':&#10;        query += ' ORDER BY s.created_at ASC';&#10;        break;&#10;      case 'recent':&#10;      default:&#10;        query += ' ORDER BY s.created_at DESC';&#10;        break;&#10;    }&#10;&#10;    const [submissions] = await conn.execute&lt;Submission[]&gt;(query, params);&#10;&#10;    const isModerator = session.role === 'moderator' || session.role === 'admin';&#10;&#10;    return (&#10;      &lt;div className=&quot;relative min-h-dvh bg-gradient-to-br from-[#1a1714] via-[#221e1a] to-[#1a1714] overflow-hidden&quot;&gt;&#10;        {/* Subtile Hintergrundeffekte */}&#10;        &lt;div className=&quot;hidden md:block pointer-events-none absolute inset-0 -z-10&quot;&gt;&#10;          &lt;div className=&quot;absolute -top-40 -left-40 h-[520px] w-[520px] rounded-full bg-[#e89a7a]/6 blur-3xl animate-pulse&quot; /&gt;&#10;          &lt;div className=&quot;absolute top-1/3 -right-32 h-[420px] w-[420px] rounded-full bg-[#8faf9d]/6 blur-3xl animate-pulse&quot; style={{ animationDelay: '1s' }} /&gt;&#10;        &lt;/div&gt;&#10;&#10;        &lt;div className=&quot;max-w-6xl mx-auto px-4 py-12&quot;&gt;&#10;          &lt;div className=&quot;text-center mb-12 animate-in fade-in slide-in-from-bottom-4 duration-700&quot;&gt;&#10;            &lt;div className=&quot;inline-flex items-center gap-2 mb-4 px-4 py-2 rounded-full bg-[#8faf9d]/10 border border-[#8faf9d]/20 shadow-lg shadow-[#8faf9d]/10&quot;&gt;&#10;              &lt;BookOpen className=&quot;h-4 w-4 text-[#8faf9d]&quot; /&gt;&#10;              &lt;span className=&quot;text-xs font-medium tracking-wide uppercase text-[#8faf9d]&quot;&gt;&#10;                Community&#10;              &lt;/span&gt;&#10;            &lt;/div&gt;&#10;            &lt;h1 className=&quot;text-4xl sm:text-5xl font-bold mb-4 bg-gradient-to-br from-[#f5f1ed] to-[#b8aea5] bg-clip-text text-transparent&quot;&gt;&#10;              Alle Beiträge&#10;            &lt;/h1&gt;&#10;            &lt;p className=&quot;text-lg text-[#b8aea5] max-w-2xl mx-auto&quot;&gt;&#10;              Entdecke die Beiträge der Schüler, vote für deine Favoriten und teile deine Meinung.&#10;            &lt;/p&gt;&#10;          &lt;/div&gt;&#10;&#10;          &lt;BrowseClient&#10;            initialSubmissions={submissions}&#10;            isModerator={isModerator}&#10;            currentUserId={session.userId}&#10;            currentSort={sortBy}&#10;            currentCategory={filterCategory}&#10;            categories={['all', ...CATEGORIES]}&#10;          /&gt;&#10;        &lt;/div&gt;&#10;      &lt;/div&gt;&#10;    );&#10;  } finally {&#10;    conn.release();&#10;  }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/uploads/submissions/[filename]/route.ts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/uploads/submissions/[filename]/route.ts" />
              <option name="originalContent" value="import { NextRequest, NextResponse } from 'next/server';&#10;}&#10;  }&#10;    return new NextResponse('Internal Server Error', { status: 500 });&#10;    console.error('Unexpected error serving submission:', err);&#10;  } catch (err) {&#10;    }&#10;      return new NextResponse('Internal Server Error', { status: 500 });&#10;      console.error('Submission serve error:', e);&#10;      }&#10;        return new NextResponse('Not Found', { status: 404 });&#10;      if (code === 'ENOENT' || code === 'ENOTDIR') {&#10;      const code = getErrorCode(e);&#10;    } catch (e: unknown) {&#10;      });&#10;        },&#10;          'Cache-Control': 'public, max-age=31536000, immutable',&#10;          'Content-Type': contentType,&#10;        headers: {&#10;        status: 200,&#10;      return new NextResponse(body, {&#10;      const body = new Blob([bytes], { type: contentType });&#10;      const bytes = new Uint8Array(data);&#10;      const contentType = getContentType(filePath);&#10;      const data = await fs.readFile(filePath);&#10;      // Check existence and read&#10;    try {&#10;&#10;    const filePath = path.join(process.cwd(), 'public', 'uploads', 'submissions', filename);&#10;&#10;    }&#10;      return new NextResponse('Not Found', { status: 404 });&#10;    if (!filename || filename.includes('..') || filename.includes('/') || filename.includes('\\')) {&#10;    // security: disallow path traversal&#10;    const { filename } = await params;&#10;  try {&#10;export async function GET(_req: NextRequest, { params }: { params: Promise&lt;{ filename: string }&gt; }) {&#10;&#10;}&#10;  return undefined;&#10;  }&#10;    return typeof code === 'string' ? code : undefined;&#10;    const code = (err as { code?: unknown }).code;&#10;  if (err &amp;&amp; typeof err === 'object' &amp;&amp; 'code' in err) {&#10;function getErrorCode(err: unknown): string | undefined {&#10;&#10;}&#10;  }&#10;      return 'application/octet-stream';&#10;    default:&#10;      return 'video/quicktime';&#10;    case '.mov':&#10;      return 'video/webm';&#10;    case '.webm':&#10;      return 'video/mp4';&#10;    case '.mp4':&#10;      return 'image/gif';&#10;    case '.gif':&#10;      return 'image/webp';&#10;    case '.webp':&#10;      return 'image/png';&#10;    case '.png':&#10;      return 'image/jpeg';&#10;    case '.jpeg':&#10;    case '.jpg':&#10;  switch (ext) {&#10;  const ext = path.extname(filePath).toLowerCase();&#10;function getContentType(filePath: string): string {&#10;&#10;export const runtime = 'nodejs';&#10;export const dynamic = 'force-dynamic';&#10;&#10;import fs from 'fs/promises';&#10;import path from 'path';&#10;&#10;" />
              <option name="updatedContent" value="import { NextRequest, NextResponse } from 'next/server';&#10;import path from 'path';&#10;import fs from 'fs/promises';&#10;&#10;export const dynamic = 'force-dynamic';&#10;export const runtime = 'nodejs';&#10;&#10;function getContentType(filePath: string): string {&#10;  const ext = path.extname(filePath).toLowerCase();&#10;  switch (ext) {&#10;    case '.jpg':&#10;    case '.jpeg':&#10;      return 'image/jpeg';&#10;    case '.png':&#10;      return 'image/png';&#10;    case '.webp':&#10;      return 'image/webp';&#10;    case '.gif':&#10;      return 'image/gif';&#10;    case '.mp4':&#10;      return 'video/mp4';&#10;    case '.webm':&#10;      return 'video/webm';&#10;    case '.mov':&#10;      return 'video/quicktime';&#10;    default:&#10;      return 'application/octet-stream';&#10;  }&#10;}&#10;&#10;function getErrorCode(err: unknown): string | undefined {&#10;  if (err &amp;&amp; typeof err === 'object' &amp;&amp; 'code' in err) {&#10;    const code = (err as { code?: unknown }).code;&#10;    return typeof code === 'string' ? code : undefined;&#10;  }&#10;  return undefined;&#10;}&#10;&#10;export async function GET(_req: NextRequest, { params }: { params: Promise&lt;{ filename: string }&gt; }) {&#10;  try {&#10;    const { filename } = await params;&#10;    // security: disallow path traversal&#10;    if (!filename || filename.includes('..') || filename.includes('/') || filename.includes('\\')) {&#10;      return new NextResponse('Not Found', { status: 404 });&#10;    }&#10;&#10;    const filePath = path.join(process.cwd(), 'public', 'uploads', 'submissions', filename);&#10;&#10;    try {&#10;      // Check existence and read&#10;      const data = await fs.readFile(filePath);&#10;      const contentType = getContentType(filePath);&#10;      const bytes = new Uint8Array(data);&#10;      const body = new Blob([bytes], { type: contentType });&#10;      return new NextResponse(body, {&#10;        status: 200,&#10;        headers: {&#10;          'Content-Type': contentType,&#10;          'Cache-Control': 'public, max-age=31536000, immutable',&#10;        },&#10;      });&#10;    } catch (e: unknown) {&#10;      const code = getErrorCode(e);&#10;      if (code === 'ENOENT' || code === 'ENOTDIR') {&#10;        return new NextResponse('Not Found', { status: 404 });&#10;      }&#10;      console.error('Submission serve error:', e);&#10;      return new NextResponse('Internal Server Error', { status: 500 });&#10;    }&#10;  } catch (err) {&#10;    console.error('Unexpected error serving submission:', err);&#10;    return new NextResponse('Internal Server Error', { status: 500 });&#10;  }&#10;}&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/next.config.ts">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/next.config.ts" />
              <option name="originalContent" value="import type { NextConfig } from &quot;next&quot;;&#10;&#10;const nextConfig: NextConfig = {&#10;  async rewrites() {&#10;    return {&#10;      beforeFiles: [&#10;        { source: &quot;/unauthorized&quot;, destination: &quot;/zugriff-verweigert&quot; },&#10;      ],&#10;      afterFiles: [],&#10;      fallback: [],&#10;    };&#10;  },&#10;  serverActions: {&#10;    bodySizeLimit: '50mb',&#10;  },&#10;};&#10;&#10;export default nextConfig;&#10;" />
              <option name="updatedContent" value="import type { NextConfig } from &quot;next&quot;;&#10;&#10;const nextConfig: NextConfig = {&#10;  async rewrites() {&#10;    return {&#10;      beforeFiles: [&#10;        { source: &quot;/unauthorized&quot;, destination: &quot;/zugriff-verweigert&quot; },&#10;      ],&#10;      afterFiles: [],&#10;      fallback: [],&#10;    };&#10;  },&#10;  experimental: {&#10;    serverActions: {&#10;      bodySizeLimit: '50mb',&#10;    },&#10;  },&#10;};&#10;&#10;export default nextConfig;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/scripts/force-dark-footer.js">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/scripts/force-dark-footer.js" />
              <option name="updatedContent" value="const fs = require('fs');&#10;const path = require('path');&#10;const file = path.resolve(__dirname, '..', 'components', 'Footer.tsx');&#10;let src = fs.readFileSync(file, 'utf8');&#10;&#10;// Ersetzungen: Light/Dark-Mix -&gt; feste Dark-Standards&#10;src = src.replace(/text-\[#2a2520\]\s+dark:text-\[#f5f1ed\]/g, 'text-[#f5f1ed]');&#10;src = src.replace(/text-\[#6b635a\]\s+dark:text-\[#b8aea5\]/g, 'text-[#b8aea5]');&#10;src = src.replace(/hover:text-\[#d97757\]\s+dark:hover:text-\[#e89a7a\]/g, 'hover:text-[#e89a7a]');&#10;src = src.replace(/border-\[#d97757\]\/10\s+dark:border-\[#e89a7a\]\/10/g, 'border-[#e89a7a]/10');&#10;&#10;// Falls noch einzelne dark:-Reste vorhanden sind (Sicherheitsnetz):&#10;src = src.replace(/\sdark:[^\s&quot;]+/g, '');&#10;&#10;fs.writeFileSync(file, src, 'utf8');&#10;console.log('Footer.tsx dark:-Varianten entfernt und Dark als Standard gesetzt.');&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>